---
phase: 31-simple-mode-ui-shell
plan: 02
type: execute
wave: 2
depends_on:
  - 31-01
files_modified:
  - packages/dashboard/src/lib/simple-mode-actions.ts
  - packages/dashboard/src/components/simple-mode/simple-mode-view.tsx
  - packages/dashboard/src/components/simple-mode/recommendation-card.tsx
  - packages/dashboard/src/components/simple-mode/action-grid.tsx
  - packages/dashboard/src/components/simple-mode/action-card.tsx
  - packages/dashboard/src/components/simple-mode/action-form.tsx
  - packages/dashboard/src/App.tsx
autonomous: false
requirements:
  - DASH-02
  - DASH-03

must_haves:
  truths:
    - "User sees a recommendation card above the tabs showing the current phase and a suggested next action with a CTA button"
    - "User can switch between 'Plan & Discuss' and 'Execute & Verify' tabs; the active tab slides in with a left/right animation"
    - "User sees action cards in a 2-column grid; each card has an icon, title, and description"
    - "Clicking an action card expands it inline (accordion); clicking another card auto-collapses the previous one"
    - "Unavailable actions are greyed out with a tooltip explaining why"
    - "Expanded card shows an auto-resize textarea pre-filled with the next unplanned phase title (for Plan New Phase / Add Phase), with a 'Start Planning' button"
    - "Clicking 'Start Planning' shows the MAXSIM command string and a 'Copy' button (Phase 32 wiring placeholder)"
    - "In the empty state (no project loaded), only 'New Project' and 'Init Existing' cards are available"
  artifacts:
    - path: "packages/dashboard/src/lib/simple-mode-actions.ts"
      provides: "Static ACTION_DEFS array — all 11 action definitions with tab, id, title, description, icon, requiresInput, isAvailable"
      exports: ["ACTION_DEFS", "ActionDef"]
    - path: "packages/dashboard/src/components/simple-mode/simple-mode-view.tsx"
      provides: "Top-level Simple Mode content panel — composes RecommendationCard + ActionGrid"
      exports: ["SimpleModeView"]
    - path: "packages/dashboard/src/components/simple-mode/recommendation-card.tsx"
      provides: "Recommendation card derived from STATE.md current phase/status; CTA navigates to relevant tab + expands card"
      exports: ["RecommendationCard"]
    - path: "packages/dashboard/src/components/simple-mode/action-grid.tsx"
      provides: "Tabbed grid (Plan & Discuss / Execute & Verify) with AnimatePresence slide + pagination (6 cards + Show more)"
      exports: ["ActionGrid"]
    - path: "packages/dashboard/src/components/simple-mode/action-card.tsx"
      provides: "Individual action card — accordion expand, hover elevation, disabled state, recommended badge"
      exports: ["ActionCard"]
    - path: "packages/dashboard/src/components/simple-mode/action-form.tsx"
      provides: "Expanded card form — auto-resize textarea, pre-fill logic, submit button (command display on submit), reset control"
      exports: ["ActionForm"]
  key_links:
    - from: "packages/dashboard/src/components/simple-mode/simple-mode-view.tsx"
      to: "useDashboardData"
      via: "reads roadmap + state for recommendation and pre-fill"
      pattern: "useDashboardData"
    - from: "packages/dashboard/src/components/simple-mode/action-card.tsx"
      to: "useSimpleMode"
      via: "reads expandedCardId; calls setExpanded; reads inputValues"
      pattern: "useSimpleMode"
    - from: "packages/dashboard/src/components/simple-mode/recommendation-card.tsx"
      to: "useSimpleMode"
      via: "CTA calls setTab + setExpanded to navigate to correct tab and open card"
      pattern: "setTab.*setExpanded|setExpanded.*setTab"
    - from: "packages/dashboard/src/App.tsx"
      to: "SimpleModeView"
      via: "replaces Plan 01 placeholder in Simple Mode content area"
      pattern: "SimpleModeView"
---

<objective>
Build the Simple Mode action screen: recommendation card, tabbed action grid, accordion cards, and the phase description input form — delivering the full DASH-02 and DASH-03 experience where users can select an action and enter a phase description without touching a terminal.

Purpose: DASH-02 acceptance: action screen with available phase actions, selecting one initiates the flow. DASH-03 acceptance: text input in browser captures phase description; passed to planning workflow (as a command string to copy in Phase 31 scope).
Output: SimpleModeView, RecommendationCard, ActionGrid, ActionCard, ActionForm, simple-mode-actions.ts action definitions — all wired into App.tsx replacing the Plan 01 placeholder.
</objective>

<execution_context>
@~/.claude/maxsim/workflows/execute-plan.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-simple-mode-ui-shell/31-CONTEXT.md
@.planning/phases/31-simple-mode-ui-shell/31-RESEARCH.md
@.planning/phases/31-simple-mode-ui-shell/31-01-SUMMARY.md
@packages/dashboard/src/App.tsx
@packages/dashboard/src/components/providers/simple-mode-provider.tsx
@packages/dashboard/src/hooks/use-dashboard-data.ts
@packages/dashboard/src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Action definitions, recommendation card, and action grid with tabs</name>
  <files>
    packages/dashboard/src/lib/simple-mode-actions.ts
    packages/dashboard/src/components/simple-mode/recommendation-card.tsx
    packages/dashboard/src/components/simple-mode/action-grid.tsx
  </files>
  <action>
**1a. Create packages/dashboard/src/lib/simple-mode-actions.ts:**

Static array of 11 action definitions. Each action has an inline SVG icon (no lucide-react). The `isAvailable` function receives the roadmap analysis and returns whether the action can be used given current project state.

```typescript
import type { RoadmapAnalysis } from "@maxsim/core";

export interface ActionDef {
  id: string;
  tab: "plan" | "execute";
  title: string;
  description: string;
  icon: React.ReactNode;
  requiresInput: boolean;          // if true: textarea required before submit; if false: optional
  command: string;                  // MAXSIM command string shown on submit
  isAvailable: (roadmap: RoadmapAnalysis | null) => boolean;
  unavailableReason: string;       // tooltip when disabled
}

// Helper: has any phases defined
function hasPhases(r: RoadmapAnalysis | null) { return (r?.phases?.length ?? 0) > 0; }
// Helper: has an in-progress or planned phase
function hasActivePhase(r: RoadmapAnalysis | null) {
  return r?.phases?.some(p => p.disk_status === "partial" || p.disk_status === "planned" || p.disk_status === "discussed" || p.disk_status === "researched") ?? false;
}

export const ACTION_DEFS: ActionDef[] = [
  // ── Plan & Discuss tab ──
  {
    id: "plan-new-phase",
    tab: "plan",
    title: "Plan New Phase",
    description: "Create a detailed execution plan for the next phase",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <rect x="3" y="4" width="14" height="13" rx="1" />
        <path d="M7 8h6M7 11h4M10 2v4" strokeLinecap="round" />
      </svg>
    ),
    requiresInput: true,
    command: "/maxsim:plan-phase",
    isAvailable: (r) => hasPhases(r),
    unavailableReason: "No phases found in ROADMAP.md — create a project first",
  },
  {
    id: "add-phase",
    tab: "plan",
    title: "Add Phase",
    description: "Insert a new phase into the roadmap",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <rect x="3" y="4" width="14" height="13" rx="1" />
        <path d="M10 8v6M7 11h6" strokeLinecap="round" />
      </svg>
    ),
    requiresInput: true,
    command: "/maxsim:add-phase",
    isAvailable: (r) => hasPhases(r),
    unavailableReason: "No project loaded — create a project first",
  },
  {
    id: "discuss-phase",
    tab: "plan",
    title: "Discuss Phase",
    description: "Answer planning questions to define requirements for a phase",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <path d="M3 6a1 1 0 011-1h12a1 1 0 011 1v7a1 1 0 01-1 1H7l-4 3V6z" strokeLinejoin="round" />
      </svg>
    ),
    requiresInput: false,
    command: "/maxsim:discuss-phase",
    isAvailable: (r) => hasActivePhase(r),
    unavailableReason: "No active phase to discuss — plan a phase first",
  },
  {
    id: "init-existing",
    tab: "plan",
    title: "Init Existing",
    description: "Set up MAXSIM planning for an existing project",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <path d="M10 3v10M10 13l-3-3M10 13l3-3" strokeLinecap="round" strokeLinejoin="round" />
        <path d="M4 17h12" strokeLinecap="round" />
      </svg>
    ),
    requiresInput: false,
    command: "/maxsim:init-existing",
    isAvailable: () => true,
    unavailableReason: "",
  },
  {
    id: "new-project",
    tab: "plan",
    title: "New Project",
    description: "Start a brand new MAXSIM project from scratch",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <path d="M10 4v12M4 10h12" strokeLinecap="round" />
      </svg>
    ),
    requiresInput: false,
    command: "/maxsim:quick",
    isAvailable: () => true,
    unavailableReason: "",
  },
  // ── Execute & Verify tab ──
  {
    id: "execute-phase",
    tab: "execute",
    title: "Execute Phase",
    description: "Run the current phase plan and implement the changes",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <path d="M6 4l10 6-10 6V4z" strokeLinejoin="round" />
      </svg>
    ),
    requiresInput: false,
    command: "/maxsim:execute-phase",
    isAvailable: (r) => hasActivePhase(r),
    unavailableReason: "No phase is currently planned — plan a phase first",
  },
  {
    id: "verify-work",
    tab: "execute",
    title: "Verify Work",
    description: "Check that completed phase work meets all acceptance criteria",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <path d="M4 10l4 4 8-8" strokeLinecap="round" strokeLinejoin="round" />
      </svg>
    ),
    requiresInput: false,
    command: "/maxsim:verify-work",
    isAvailable: (r) => hasPhases(r),
    unavailableReason: "No phases to verify — complete a phase first",
  },
  {
    id: "audit-milestone",
    tab: "execute",
    title: "Audit Milestone",
    description: "Review and archive a completed milestone",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <path d="M4 5h12M4 10h8M4 15h10" strokeLinecap="round" />
        <circle cx="16" cy="14" r="2.5" />
        <path d="M18 16l1.5 1.5" strokeLinecap="round" />
      </svg>
    ),
    requiresInput: false,
    command: "/maxsim:audit-milestone",
    isAvailable: (r) => hasPhases(r),
    unavailableReason: "No milestone to audit — complete some phases first",
  },
  {
    id: "fix-gaps",
    tab: "execute",
    title: "Fix Gaps",
    description: "Create plans to close verification failures",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <path d="M10 4v6h6" strokeLinecap="round" strokeLinejoin="round" />
        <path d="M4 10a6 6 0 1012 0" strokeLinecap="round" />
      </svg>
    ),
    requiresInput: false,
    command: "/maxsim:plan-phase --gaps",
    isAvailable: (r) => hasPhases(r),
    unavailableReason: "No phases to fix — complete a verification first",
  },
  {
    id: "find-gaps",
    tab: "execute",
    title: "Find Gaps",
    description: "Identify missing requirements or unverified work",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <circle cx="9" cy="9" r="5" />
        <path d="M16 16l-3-3" strokeLinecap="round" />
        <path d="M9 7v2M9 11h.01" strokeLinecap="round" />
      </svg>
    ),
    requiresInput: false,
    command: "/maxsim:verify-work --find-gaps",
    isAvailable: (r) => hasPhases(r),
    unavailableReason: "No phases to analyze — create some phases first",
  },
  {
    id: "view-roadmap",
    tab: "execute",
    title: "View Roadmap",
    description: "See all phases and their status inline",
    icon: (
      <svg className="h-5 w-5 shrink-0" viewBox="0 0 20 20" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
        <path d="M3 5h14M3 10h14M3 15h8" strokeLinecap="round" />
      </svg>
    ),
    requiresInput: false,
    command: "",          // No command — inline roadmap view
    isAvailable: (r) => hasPhases(r),
    unavailableReason: "No roadmap to display",
  },
];
```

**1b. Create packages/dashboard/src/components/simple-mode/recommendation-card.tsx:**

Derives next recommended action from `state` and `roadmap` data. Logic (Phase 31, STATE.md only):
- If `state.status` includes "Ready to plan" or current phase has `disk_status === "empty"/"no_directory"` → recommend "plan-new-phase"
- If current phase has `disk_status === "discussed"` or `"researched"` → recommend "plan-new-phase"
- If current phase has `disk_status === "planned"` → recommend "execute-phase"
- If current phase has `disk_status === "partial"` (summary exists, plans remain) → recommend "execute-phase"
- If current phase has `disk_status === "complete"` → recommend "verify-work"
- Fallback: no recommendation card shown (return null)

CTA button calls `setTab` + `setExpanded` to navigate to the correct tab and open the card:

```typescript
import { useDashboardData } from "@/hooks/use-dashboard-data";
import { useSimpleMode } from "@/components/providers/simple-mode-provider";
import type { SimpleTab } from "@/components/providers/simple-mode-provider";
import { ACTION_DEFS } from "@/lib/simple-mode-actions";

export function RecommendationCard() {
  const { roadmap, state } = useDashboardData();
  const { setTab, setExpanded } = useSimpleMode();

  // Derive recommendation
  const currentPhaseData = roadmap?.phases?.find(p => p.number === roadmap?.current_phase);
  let recommendedActionId: string | null = null;

  if (currentPhaseData) {
    const s = currentPhaseData.disk_status;
    if (s === "empty" || s === "no_directory" || s === "discussed" || s === "researched") {
      recommendedActionId = "plan-new-phase";
    } else if (s === "planned") {
      recommendedActionId = "execute-phase";
    } else if (s === "partial") {
      recommendedActionId = "execute-phase";
    } else if (s === "complete") {
      recommendedActionId = "verify-work";
    }
  } else if (roadmap?.phases?.length === 0) {
    recommendedActionId = "new-project";
  }

  if (!recommendedActionId) return null;

  const action = ACTION_DEFS.find(a => a.id === recommendedActionId);
  if (!action) return null;

  const tabLabel = action.tab === "plan" ? "Plan & Discuss" : "Execute & Verify";
  const phaseName = currentPhaseData ? `Phase ${currentPhaseData.number}: ${currentPhaseData.name}` : "your project";

  function handleCTA() {
    const tab: SimpleTab = action!.tab;
    setTab(tab);
    setExpanded(action!.id);
  }

  return (
    <div className="border border-simple-accent/40 bg-simple-accent/5 p-4 flex items-center justify-between gap-4 mb-4">
      <div className="min-w-0">
        <p className="text-xs uppercase tracking-widest text-simple-accent font-mono mb-1">Recommended</p>
        <p className="text-sm text-foreground">
          <span className="font-medium">{phaseName}</span> is ready to{" "}
          <span className="text-simple-accent">{action.title.toLowerCase()}</span>
        </p>
      </div>
      <button
        type="button"
        onClick={handleCTA}
        className="shrink-0 border border-simple-accent bg-simple-accent/10 px-3 py-1.5 text-xs font-mono uppercase tracking-widest text-simple-accent transition-colors hover:bg-simple-accent hover:text-background"
      >
        {action.title}
      </button>
    </div>
  );
}
```

**1c. Create packages/dashboard/src/components/simple-mode/action-grid.tsx:**

Tabbed grid with `AnimatePresence` + `motion.div` slide animation (mode="wait", 150ms). Pagination: 6 cards shown initially, "Show more" appends all remaining in-place. Each tab shows its action count in the label. On tab switch: resets expanded card via context (already handled by `SET_TAB` reducer). Track previous tab for slide direction.

```typescript
import { useState, useRef } from "react";
import { motion, AnimatePresence } from "motion/react";
import { cn } from "@/lib/utils";
import { useDashboardData } from "@/hooks/use-dashboard-data";
import { useSimpleMode } from "@/components/providers/simple-mode-provider";
import type { SimpleTab } from "@/components/providers/simple-mode-provider";
import { ACTION_DEFS } from "@/lib/simple-mode-actions";
import { ActionCard } from "./action-card";

const PAGE_SIZE = 6;

export function ActionGrid() {
  const { roadmap } = useDashboardData();
  const { activeTab, setTab } = useSimpleMode();
  const prevTabRef = useRef<SimpleTab>(activeTab);
  const [showAll, setShowAll] = useState<Record<SimpleTab, boolean>>({ plan: false, execute: false });

  const roadmapData = roadmap ?? null;

  const planActions = ACTION_DEFS.filter(a => a.tab === "plan");
  const executeActions = ACTION_DEFS.filter(a => a.tab === "execute");

  const isEmptyState = (roadmap?.phases?.length ?? 0) === 0;

  // In empty state: only show new-project and init-existing in plan tab; nothing in execute tab
  const filteredPlan = isEmptyState
    ? planActions.filter(a => a.id === "new-project" || a.id === "init-existing")
    : planActions;
  const filteredExecute = isEmptyState ? [] : executeActions;

  const tabActions = activeTab === "plan" ? filteredPlan : filteredExecute;
  const showAllForTab = showAll[activeTab];
  const visibleActions = showAllForTab ? tabActions : tabActions.slice(0, PAGE_SIZE);
  const hasMore = tabActions.length > PAGE_SIZE && !showAllForTab;

  function handleTabChange(tab: SimpleTab) {
    prevTabRef.current = activeTab;
    setTab(tab);
    // Reset showAll for new tab
    setShowAll(prev => ({ ...prev }));
  }

  const slideDir = activeTab === "plan" && prevTabRef.current === "execute" ? -1 : 1;

  return (
    <div className="flex flex-col gap-0">
      {/* Tab bar */}
      <div className="flex border-b border-border">
        {(["plan", "execute"] as SimpleTab[]).map((tab) => {
          const count = tab === "plan" ? filteredPlan.length : filteredExecute.length;
          const label = tab === "plan" ? "Plan & Discuss" : "Execute & Verify";
          return (
            <button
              key={tab}
              type="button"
              onClick={() => handleTabChange(tab)}
              className={cn(
                "flex-1 py-2.5 text-xs font-mono uppercase tracking-widest transition-colors duration-200 border-b-2",
                activeTab === tab
                  ? "border-b-simple-accent text-simple-accent"
                  : "border-b-transparent text-muted-foreground hover:text-foreground"
              )}
            >
              {label} ({count})
            </button>
          );
        })}
      </div>

      {/* Tab content with slide animation */}
      <div className="overflow-hidden">
        <AnimatePresence mode="wait" initial={false}>
          <motion.div
            key={activeTab}
            initial={{ x: slideDir * 20, opacity: 0 }}
            animate={{ x: 0, opacity: 1 }}
            exit={{ x: slideDir * -20, opacity: 0 }}
            transition={{ duration: 0.15 }}
          >
            {tabActions.length === 0 ? (
              <div className="py-12 text-center">
                <p className="text-sm text-muted-foreground">No actions available in this tab.</p>
              </div>
            ) : (
              <>
                <div className="grid grid-cols-2 gap-px bg-border sm:grid-cols-2 lg:grid-cols-3">
                  {visibleActions.map(action => (
                    <ActionCard
                      key={action.id}
                      action={action}
                      roadmap={roadmapData}
                    />
                  ))}
                </div>
                {hasMore && (
                  <button
                    type="button"
                    onClick={() => setShowAll(prev => ({ ...prev, [activeTab]: true }))}
                    className="w-full border-t border-border py-2.5 text-xs font-mono uppercase tracking-widest text-muted-foreground transition-colors hover:text-foreground hover:bg-card-hover"
                  >
                    Show more ({tabActions.length - PAGE_SIZE} more)
                  </button>
                )}
              </>
            )}
          </motion.div>
        </AnimatePresence>
      </div>
    </div>
  );
}
```
  </action>
  <verify>
    <automated>cd C:/Development/cli/maxsim/packages/dashboard && npx tsc --noEmit 2>&1 | head -40</automated>
  </verify>
  <done>
    - `simple-mode-actions.ts` exports `ACTION_DEFS` (11 actions) and `ActionDef` type
    - `recommendation-card.tsx` renders a teal-accented card derived from roadmap + state; CTA opens correct tab+card via context
    - `action-grid.tsx` renders tab bar with counts; `AnimatePresence` slide (mode="wait"); 6-card pagination with "Show more"; empty state shows only New Project + Init Existing
    - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: ActionCard, ActionForm with auto-resize textarea, SimpleModeView, and App.tsx wiring</name>
  <files>
    packages/dashboard/src/components/simple-mode/action-card.tsx
    packages/dashboard/src/components/simple-mode/action-form.tsx
    packages/dashboard/src/components/simple-mode/simple-mode-view.tsx
    packages/dashboard/src/App.tsx
  </files>
  <action>
**2a. Create packages/dashboard/src/components/simple-mode/action-card.tsx:**

Accordion behavior driven by `expandedCardId` from `useSimpleMode`. Click toggles expansion. Hover: `hover:shadow-md hover:-translate-y-px transition-all`. Disabled state: `opacity-50 cursor-not-allowed` with tooltip. Recommended badge: shown when the action ID matches the recommended action computed the same way as `RecommendationCard`. Expanded region uses `motion/react` `AnimatePresence` with `animate={{ height: "auto" }}` for smooth accordion (per RESEARCH.md Pitfall 3 — do NOT use CSS `height: 0 → auto`; use `motion/react`).

```typescript
import { motion, AnimatePresence } from "motion/react";
import { cn } from "@/lib/utils";
import { useSimpleMode } from "@/components/providers/simple-mode-provider";
import { useDashboardData } from "@/hooks/use-dashboard-data";
import type { ActionDef } from "@/lib/simple-mode-actions";
import type { RoadmapAnalysis } from "@maxsim/core";
import { ActionForm } from "./action-form";

interface ActionCardProps {
  action: ActionDef;
  roadmap: RoadmapAnalysis | null;
}

export function ActionCard({ action, roadmap }: ActionCardProps) {
  const { expandedCardId, setExpanded } = useSimpleMode();
  const { roadmap: roadmapData, state } = useDashboardData();
  const isOpen = expandedCardId === action.id;
  const isDisabled = !action.isAvailable(roadmap);

  // Determine if this card is the recommended action (same logic as RecommendationCard)
  const currentPhaseData = roadmapData?.phases?.find(p => p.number === roadmapData?.current_phase);
  let recommendedId: string | null = null;
  if (currentPhaseData) {
    const s = currentPhaseData.disk_status;
    if (s === "empty" || s === "no_directory" || s === "discussed" || s === "researched") recommendedId = "plan-new-phase";
    else if (s === "planned" || s === "partial") recommendedId = "execute-phase";
    else if (s === "complete") recommendedId = "verify-work";
  } else if ((roadmapData?.phases?.length ?? 0) === 0) {
    recommendedId = "new-project";
  }
  const isRecommended = action.id === recommendedId;

  function handleClick() {
    if (isDisabled) return;
    setExpanded(isOpen ? null : action.id);
  }

  return (
    <div
      className={cn(
        "relative bg-card border-0 transition-all duration-200",
        isDisabled ? "opacity-50" : "cursor-pointer hover:shadow-md hover:-translate-y-px",
        isOpen && "ring-1 ring-simple-accent/40"
      )}
      title={isDisabled ? action.unavailableReason : undefined}
    >
      {/* Recommended badge */}
      {isRecommended && !isDisabled && (
        <span className="absolute top-2 right-2 z-10 bg-simple-accent/20 border border-simple-accent/40 px-1.5 py-0.5 text-[10px] font-mono uppercase tracking-wider text-simple-accent">
          Recommended
        </span>
      )}

      {/* Card header button */}
      <button
        type="button"
        disabled={isDisabled}
        onClick={handleClick}
        className="flex w-full items-start gap-3 p-4 text-left"
        aria-expanded={isOpen}
      >
        <span className={cn(
          "mt-0.5 shrink-0",
          isDisabled ? "text-muted-foreground" : "text-simple-accent"
        )}>
          {action.icon}
        </span>
        <div className="flex-1 min-w-0 pr-6">
          <p className="text-sm font-medium text-foreground leading-tight">{action.title}</p>
          <p className="text-xs text-muted-foreground mt-0.5 leading-snug">{action.description}</p>
        </div>
        {/* Chevron */}
        <svg
          className={cn("mt-1 h-3.5 w-3.5 shrink-0 text-muted-foreground transition-transform duration-200", isOpen && "rotate-180")}
          viewBox="0 0 12 12"
          fill="none"
          stroke="currentColor"
          strokeWidth="1.5"
          aria-hidden="true"
        >
          <path d="M2 4l4 4 4-4" strokeLinecap="round" strokeLinejoin="round" />
        </svg>
      </button>

      {/* Accordion expand */}
      <AnimatePresence initial={false}>
        {isOpen && (
          <motion.div
            key="expanded"
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: "auto", opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            transition={{ duration: 0.2, ease: "easeInOut" }}
            className="overflow-hidden border-t border-border/60"
          >
            <div className="p-4">
              <ActionForm action={action} />
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}
```

**2b. Create packages/dashboard/src/components/simple-mode/action-form.tsx:**

Expanded card form with:
- Auto-resize textarea (pure DOM: `scrollHeight` reset on input, per RESEARCH.md Pattern 3)
- Enter key submits, Shift+Enter inserts newline
- Pre-fill for `requiresInput === true` actions: derive next unplanned phase title from roadmap (filter: `!p.roadmap_complete && (p.disk_status === 'empty' || p.disk_status === 'no_directory')`)
- Optional textarea for `requiresInput === false` actions (placeholder: "Additional context (optional)")
- Submit button disabled when `requiresInput === true && inputValue.trim() === ""`
- On submit: show the MAXSIM command string + "Copy" button (Phase 32 will replace with actual execution)
- "..." overflow menu in bottom-right: "Reset Simple Mode" with confirmation dialog (calls `useSimpleMode().reset()`)
- Read/write input value via `useSimpleMode().inputValues[action.id]` and `setInput`

```typescript
import { useRef, useState, useEffect } from "react";
import { cn } from "@/lib/utils";
import { useSimpleMode } from "@/components/providers/simple-mode-provider";
import { useDashboardData } from "@/hooks/use-dashboard-data";
import type { ActionDef } from "@/lib/simple-mode-actions";

interface ActionFormProps {
  action: ActionDef;
}

export function ActionForm({ action }: ActionFormProps) {
  const { inputValues, setInput, reset } = useSimpleMode();
  const { roadmap } = useDashboardData();
  const textareaRef = useRef<HTMLTextAreaElement>(null);
  const [submitted, setSubmitted] = useState(false);
  const [copied, setCopied] = useState(false);
  const [showReset, setShowReset] = useState(false);
  const [confirmReset, setConfirmReset] = useState(false);

  // Derive pre-fill value for requiresInput actions
  const prefill = (() => {
    if (!action.requiresInput) return "";
    const nextPhase = roadmap?.phases?.find(
      p => !p.roadmap_complete && (p.disk_status === "empty" || p.disk_status === "no_directory")
    );
    if (nextPhase) return `Phase ${nextPhase.number}: ${nextPhase.name}`;
    return "";
  })();

  // Initialize input value from context (or prefill if not yet set)
  const value = inputValues[action.id] ?? prefill;

  // Auto-resize on mount and value change
  useEffect(() => {
    const el = textareaRef.current;
    if (!el) return;
    el.style.height = "auto";
    el.style.height = `${el.scrollHeight}px`;
  }, [value]);

  function handleInput() {
    const el = textareaRef.current;
    if (!el) return;
    el.style.height = "auto";
    el.style.height = `${el.scrollHeight}px`;
  }

  function handleChange(v: string) {
    setInput(action.id, v);
  }

  function handleKeyDown(e: React.KeyboardEvent) {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleSubmit();
    }
  }

  // Build the final command string shown after submit
  function buildCommandString() {
    const trimmed = value.trim();
    if (action.command === "") return ""; // view-roadmap: no command
    return trimmed ? `${action.command} "${trimmed}"` : action.command;
  }

  function handleSubmit() {
    if (action.requiresInput && !value.trim()) return;
    if (action.id === "view-roadmap") return; // handled differently
    setSubmitted(true);
  }

  async function handleCopy() {
    const cmd = buildCommandString();
    try {
      await navigator.clipboard.writeText(cmd);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch { /* ignore */ }
  }

  function handleResetClick() {
    if (confirmReset) {
      reset();
      setConfirmReset(false);
      setShowReset(false);
    } else {
      setConfirmReset(true);
      setTimeout(() => setConfirmReset(false), 3000);
    }
  }

  const isDisabledSubmit = action.requiresInput && !value.trim();

  if (submitted && action.id !== "view-roadmap") {
    const cmd = buildCommandString();
    return (
      <div className="flex flex-col gap-3">
        <p className="text-xs text-muted-foreground">
          Paste this command in your Claude Code terminal to start:
        </p>
        <div className="flex items-center gap-2 border border-border bg-muted/20 px-3 py-2">
          <code className="flex-1 font-mono text-xs text-foreground break-all">{cmd}</code>
          <button
            type="button"
            onClick={handleCopy}
            className="shrink-0 border border-border px-2 py-1 text-xs font-mono text-muted-foreground transition-colors hover:text-foreground hover:bg-card-hover"
          >
            {copied ? "Copied!" : "Copy"}
          </button>
        </div>
        <button
          type="button"
          onClick={() => setSubmitted(false)}
          className="text-xs text-muted-foreground underline underline-offset-2 hover:text-foreground self-start"
        >
          Back
        </button>
      </div>
    );
  }

  return (
    <div className="flex flex-col gap-3 relative">
      {/* Help text */}
      <p className="text-xs text-muted-foreground">
        {action.requiresInput
          ? "Describe what this phase should accomplish."
          : "Add optional context (or leave blank to use defaults)."}
      </p>

      {/* Auto-resize textarea */}
      <div className="border border-border bg-muted/10 px-3 py-2 flex gap-2 items-start">
        <textarea
          ref={textareaRef}
          value={value}
          onChange={(e) => { handleChange(e.target.value); handleInput(); }}
          onKeyDown={handleKeyDown}
          placeholder={action.requiresInput
            ? "e.g. Phase 31: Simple Mode UI Shell"
            : "Additional context (optional)"}
          rows={1}
          className="w-full resize-none overflow-hidden bg-transparent font-mono text-xs text-foreground placeholder:text-muted-foreground outline-none leading-relaxed"
        />
      </div>

      {/* Submit + overflow menu row */}
      <div className="flex items-center gap-2">
        <button
          type="button"
          onClick={handleSubmit}
          disabled={isDisabledSubmit}
          className={cn(
            "flex items-center gap-1.5 border px-3 py-1.5 text-xs font-mono uppercase tracking-widest transition-colors",
            isDisabledSubmit
              ? "border-border text-muted-foreground cursor-not-allowed"
              : "border-simple-accent bg-simple-accent/10 text-simple-accent hover:bg-simple-accent hover:text-background"
          )}
        >
          <svg className="h-3 w-3" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true">
            <path d="M2 2l8 4-8 4V2z" />
          </svg>
          Start Planning
        </button>

        {/* "..." overflow menu for Reset Simple Mode */}
        <div className="relative ml-auto">
          <button
            type="button"
            onClick={() => setShowReset(v => !v)}
            aria-label="More options"
            className="flex h-6 w-6 items-center justify-center text-muted-foreground hover:text-foreground"
          >
            <svg className="h-3.5 w-3.5" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <circle cx="4" cy="8" r="1.2" /><circle cx="8" cy="8" r="1.2" /><circle cx="12" cy="8" r="1.2" />
            </svg>
          </button>
          {showReset && (
            <div className="absolute right-0 bottom-8 z-20 border border-border bg-card shadow-lg min-w-max">
              <button
                type="button"
                onClick={handleResetClick}
                className={cn(
                  "flex w-full items-center gap-2 px-4 py-2.5 text-xs text-left transition-colors",
                  confirmReset
                    ? "text-danger hover:bg-danger/10"
                    : "text-muted-foreground hover:text-foreground hover:bg-card-hover"
                )}
              >
                {confirmReset ? "Click again to confirm reset" : "Reset Simple Mode"}
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
```

**2c. Create packages/dashboard/src/components/simple-mode/simple-mode-view.tsx:**

Top-level Simple Mode content panel. Composes `RecommendationCard` + `ActionGrid`. Full-height scrollable container with appropriate padding.

```typescript
import { RecommendationCard } from "./recommendation-card";
import { ActionGrid } from "./action-grid";

export function SimpleModeView() {
  return (
    <div className="flex flex-col gap-0 h-full">
      {/* Scrollable content area */}
      <div className="flex-1 overflow-y-auto p-4 sm:p-6">
        <div className="mx-auto max-w-3xl flex flex-col gap-4">
          <RecommendationCard />
          <ActionGrid />
        </div>
      </div>
    </div>
  );
}
```

**2d. Modify App.tsx — replace Plan 01 placeholder with SimpleModeView:**

Find the Plan 01 placeholder comment ("Simple Mode content area — Plan 02 replaces this" or similar placeholder `<p>` element) in the Simple Mode content block. Replace it with:

```tsx
import { SimpleModeView } from "@/components/simple-mode/simple-mode-view";

// In the Simple Mode conditional branch:
{mode === "simple" && initialized && (
  <div className="flex flex-col flex-1 min-h-0">
    <SimpleModeView />
  </div>
)}
```

Ensure the SimpleModeView replaces the placeholder `<p>` and occupies the full height of the Simple Mode content area.
  </action>
  <verify>
    <automated>cd C:/Development/cli/maxsim && npm run build 2>&1 | tail -20</automated>
  </verify>
  <done>
    - `action-card.tsx` exported with accordion (motion/react height animation), hover elevation, disabled state, recommended badge
    - `action-form.tsx` exported with auto-resize textarea, pre-fill, Enter-to-submit, post-submit command display + copy, Reset overflow menu with confirmation
    - `simple-mode-view.tsx` exported, composes RecommendationCard + ActionGrid
    - App.tsx imports and renders `SimpleModeView` in the Simple Mode branch
    - `npm run build` exits 0
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human verification of complete Simple Mode UI Shell</name>
  <files>none — human verification only</files>
  <action>Human verifies the complete Simple Mode UI Shell works as specified. Follow the how-to-verify steps below.</action>
  <verify>
    <automated>cd C:/Development/cli/maxsim &amp;&amp; npm run build 2&gt;&amp;1 | tail -5</automated>
  </verify>
  <done>Human approves: mode toggle works, first-run card shown, tabs animate, accordion expands, form submits with command display, persistence works across refresh.</done>
  <what-built>
    Complete Simple Mode UI Shell:
    - Mode toggle in header (Globe/Terminal icon, spin animation, teal accent in Simple Mode)
    - First-run welcome card (blurred backdrop, SVG illustrations, two CTAs)
    - Tabbed action grid (Plan &amp; Discuss / Execute &amp; Verify with slide animation)
    - Recommendation card (teal-bordered, STATE.md derived, CTA navigates to correct tab+card)
    - Accordion action cards (hover elevation, disabled state with tooltip, recommended badge)
    - Action form (auto-resize textarea, pre-fill from ROADMAP.md, Enter to submit, command display + copy, Reset overflow menu)
    - Mode persistence (localStorage + /api/simple-mode-config server endpoint)
  </what-built>
  <how-to-verify>
    1. Build: `cd C:/Development/cli/maxsim && npm run build` — must exit 0

    2. Start dashboard dev server: `cd packages/dashboard && npm run dev`
       Visit http://localhost:5173

    3. First-run flow (clear localStorage first):
       - Welcome card appears with blurred background — can't dismiss by pressing Escape or clicking outside
       - Card shows SVG illustrations for both modes + two CTA buttons
       - Click "Use Simple Mode" → header shifts to teal accent, sidebar disappears, toggle shows Globe icon

    4. Simple Mode UX:
       - Recommendation card appears above tabs (teal border) with a suggested action and CTA
       - Two tabs visible: "Plan &amp; Discuss (5)" and "Execute &amp; Verify (6)" — counts match action counts
       - Click "Execute &amp; Verify" tab → slide animation, cards change
       - Click a card → expands with accordion animation (smooth height transition)
       - Click another card → previous card collapses, new one opens
       - "Plan New Phase" card expanded: textarea pre-filled with next unplanned phase; Enter key submits; shows command string + Copy button
       - Actions unavailable for project state are greyed out; hovering shows tooltip reason
       - "..." menu in expanded card → "Reset Simple Mode" → confirm click → all cards collapse, tabs reset

    5. Mode toggle:
       - Click toggle → spin animation → Advanced Mode (blue header, sidebar visible, Terminal icon)
       - Click toggle again → spin animation → back to Simple Mode (teal header, no sidebar)

    6. Persistence:
       - Set Simple Mode, refresh page → stays in Simple Mode (no welcome card)
       - Check localStorage: `maxsim_dashboard_mode` = "simple"
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:

1. `npm run build` exits 0 (full monorepo build including dashboard)
2. TypeScript: `cd packages/dashboard && npx tsc --noEmit` — no errors
3. All 11 ACTION_DEFS present in simple-mode-actions.ts (5 plan tab + 6 execute tab)
4. Human verification checkpoint passes (see task 3 above)
</verification>

<success_criteria>
- DASH-02: User can select "Plan New Phase" or "Add Phase" from the Simple Mode action screen; card expands with action form
- DASH-03: Auto-resize textarea captures phase description; pre-filled with next unplanned phase title from ROADMAP.md; Enter submits; MAXSIM command shown for copying
- Action cards contextually disabled when unavailable (empty state shows only New Project + Init Existing)
- Recommendation card shown above tabs, derived from STATE.md + roadmap current phase status
- Tabs animate with left/right slide (AnimatePresence mode="wait")
- Accordion expand/collapse uses motion/react height animation (no CSS `height: auto` jank)
- Reset overflow menu with confirmation resets tab + expanded card + input values
- Full build passes: `npm run build` exit 0
</success_criteria>

<output>
After completion, create `.planning/phases/31-simple-mode-ui-shell/31-02-SUMMARY.md`
</output>
