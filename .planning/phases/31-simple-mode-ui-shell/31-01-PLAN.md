---
phase: 31-simple-mode-ui-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/dashboard/src/index.css
  - packages/dashboard/src/lib/types.ts
  - packages/dashboard/src/components/providers/simple-mode-provider.tsx
  - packages/dashboard/src/hooks/use-dashboard-mode.ts
  - packages/dashboard/src/components/simple-mode/mode-toggle-button.tsx
  - packages/dashboard/src/components/simple-mode/first-run-card.tsx
  - packages/dashboard/src/components/layout/app-shell.tsx
  - packages/dashboard/src/components/layout/sidebar.tsx
  - packages/dashboard/src/App.tsx
  - packages/dashboard/src/server.ts
autonomous: true
requirements:
  - DASH-01

must_haves:
  truths:
    - "User can click a mode toggle button in the dashboard header/sidebar and switch between Simple Mode and Advanced Mode"
    - "The header background shifts to a teal/green accent in Simple Mode — visually distinct from Advanced Mode blue"
    - "Mode preference persists across page refreshes (localStorage and server config)"
    - "First-time visitors see an inline welcome card with two CTA buttons to choose their mode; the card is non-dismissable"
    - "The toggle button shows the correct icon for the current mode (Globe in Simple, Terminal in Advanced) with a spin animation on switch"
    - "In Simple Mode, the sidebar and terminal panel are hidden — the main content area is full-width"
  artifacts:
    - path: "packages/dashboard/src/components/providers/simple-mode-provider.tsx"
      provides: "SimpleModeProvider + useSimpleMode hook (in-memory session state)"
      exports: ["SimpleModeProvider", "useSimpleMode", "SimpleTab"]
    - path: "packages/dashboard/src/hooks/use-dashboard-mode.ts"
      provides: "useDashboardMode hook — persisted mode preference (localStorage + server)"
      exports: ["useDashboardMode", "DashboardMode"]
    - path: "packages/dashboard/src/components/simple-mode/mode-toggle-button.tsx"
      provides: "Icon-only mode toggle button (Globe/Terminal inline SVG, spin animation)"
      exports: ["ModeToggleButton"]
    - path: "packages/dashboard/src/components/simple-mode/first-run-card.tsx"
      provides: "First-run welcome card with blurred backdrop and two CTAs"
      exports: ["FirstRunCard"]
    - path: "packages/dashboard/src/server.ts"
      provides: "GET/POST /api/simple-mode-config endpoints for server-side mode persistence"
      contains: "app.get('/api/simple-mode-config'"
  key_links:
    - from: "packages/dashboard/src/App.tsx"
      to: "SimpleModeProvider"
      via: "wraps DashboardApp alongside WebSocketProvider"
      pattern: "SimpleModeProvider"
    - from: "packages/dashboard/src/App.tsx"
      to: "useDashboardMode"
      via: "mode state drives sidebar visibility and content rendering"
      pattern: "useDashboardMode"
    - from: "packages/dashboard/src/components/layout/app-shell.tsx"
      to: "ModeToggleButton"
      via: "headerRight ReactNode prop (mobile top bar)"
      pattern: "headerRight"
    - from: "packages/dashboard/src/components/layout/sidebar.tsx"
      to: "ModeToggleButton"
      via: "logoAction ReactNode prop (desktop sidebar logo area)"
      pattern: "logoAction"
    - from: "packages/dashboard/src/hooks/use-dashboard-mode.ts"
      to: "/api/simple-mode-config"
      via: "fetch on mount (read) and setMode (write)"
      pattern: "fetch.*simple-mode-config"
---

<objective>
Build the Simple Mode foundation: context provider, mode persistence hook, toggle button, first-run welcome card, AppShell/Sidebar header slots, and CSS color token — everything needed so users can enter and exit Simple Mode with the correct visual treatment.

Purpose: DASH-01 acceptance requires Simple mode accessible via toggle/button from dashboard with terminal panel hidden. This plan delivers the entire infrastructure layer for that toggle.
Output: SimpleModeProvider, useDashboardMode hook, ModeToggleButton, FirstRunCard, AppShell/Sidebar slot additions, /api/simple-mode-config server endpoint, teal color token in index.css.
</objective>

<execution_context>
@~/.claude/maxsim/workflows/execute-plan.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-simple-mode-ui-shell/31-CONTEXT.md
@.planning/phases/31-simple-mode-ui-shell/31-RESEARCH.md
@packages/dashboard/src/App.tsx
@packages/dashboard/src/components/layout/app-shell.tsx
@packages/dashboard/src/components/layout/sidebar.tsx
@packages/dashboard/src/index.css
@packages/dashboard/src/server.ts
@packages/dashboard/src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add teal color token, SimpleModeProvider, useDashboardMode hook, and DashboardMode types</name>
  <files>
    packages/dashboard/src/index.css
    packages/dashboard/src/lib/types.ts
    packages/dashboard/src/components/providers/simple-mode-provider.tsx
    packages/dashboard/src/hooks/use-dashboard-mode.ts
  </files>
  <action>
**1a. index.css — add simple-accent color to BOTH `:root` and `@theme` blocks (per Pitfall 6):**

In `:root` add after `--color-card-hover: #1f1f23;`:
```css
--color-simple-accent: #14b8a6;
```
In `@theme` add after `--color-card-hover: #1f1f23;`:
```css
--color-simple-accent: #14b8a6;
```
This enables Tailwind v4 utility classes `bg-simple-accent`, `border-simple-accent`, `text-simple-accent`.

**1b. lib/types.ts — add DashboardMode type:**

After the existing exports, add:
```typescript
/** Dashboard display mode — persisted in localStorage and server config */
export type DashboardMode = "simple" | "advanced";
```

**1c. Create packages/dashboard/src/components/providers/simple-mode-provider.tsx:**

New file — `SimpleModeContext` using `useReducer`. Holds in-memory session state: `activeTab`, `expandedCardId`, `inputValues`. Does NOT hold mode preference (that lives in `useDashboardMode`).

```typescript
import { createContext, useContext, useReducer, useCallback, type ReactNode } from "react";

export type SimpleTab = "plan" | "execute";

interface SimpleModeState {
  activeTab: SimpleTab;
  expandedCardId: string | null;
  inputValues: Record<string, string>;
}

type SimpleModeAction =
  | { type: "SET_TAB"; tab: SimpleTab }
  | { type: "SET_EXPANDED"; cardId: string | null }
  | { type: "SET_INPUT"; cardId: string; value: string }
  | { type: "RESET" };

function reducer(state: SimpleModeState, action: SimpleModeAction): SimpleModeState {
  switch (action.type) {
    case "SET_TAB":
      return { ...state, activeTab: action.tab, expandedCardId: null };
    case "SET_EXPANDED":
      return { ...state, expandedCardId: action.cardId };
    case "SET_INPUT":
      return { ...state, inputValues: { ...state.inputValues, [action.cardId]: action.value } };
    case "RESET":
      return { activeTab: "plan", expandedCardId: null, inputValues: {} };
    default:
      return state;
  }
}

const INITIAL: SimpleModeState = { activeTab: "plan", expandedCardId: null, inputValues: {} };

interface SimpleModeContextValue extends SimpleModeState {
  setTab: (tab: SimpleTab) => void;
  setExpanded: (cardId: string | null) => void;
  setInput: (cardId: string, value: string) => void;
  reset: () => void;
}

const SimpleModeContext = createContext<SimpleModeContextValue | null>(null);

export function SimpleModeProvider({ children }: { children: ReactNode }) {
  const [state, dispatch] = useReducer(reducer, INITIAL);
  const setTab = useCallback((tab: SimpleTab) => dispatch({ type: "SET_TAB", tab }), []);
  const setExpanded = useCallback((cardId: string | null) => dispatch({ type: "SET_EXPANDED", cardId }), []);
  const setInput = useCallback((cardId: string, value: string) => dispatch({ type: "SET_INPUT", cardId, value }), []);
  const reset = useCallback(() => dispatch({ type: "RESET" }), []);
  return (
    <SimpleModeContext.Provider value={{ ...state, setTab, setExpanded, setInput, reset }}>
      {children}
    </SimpleModeContext.Provider>
  );
}

export function useSimpleMode(): SimpleModeContextValue {
  const ctx = useContext(SimpleModeContext);
  if (!ctx) throw new Error("useSimpleMode must be used within SimpleModeProvider");
  return ctx;
}
```

**1d. Create packages/dashboard/src/hooks/use-dashboard-mode.ts:**

This hook manages the persisted mode preference. `mode` is `null` until initialized (triggers first-run card). Read localStorage synchronously before first render to avoid flash (per Pitfall 2).

```typescript
import { useState, useEffect } from "react";
import type { DashboardMode } from "@/lib/types";

const LS_KEY = "maxsim_dashboard_mode";

export function useDashboardMode() {
  // Initialize synchronously from localStorage to prevent first-run flash
  const [mode, setModeState] = useState<DashboardMode | null>(() => {
    try {
      const ls = localStorage.getItem(LS_KEY);
      if (ls === "simple" || ls === "advanced") return ls;
    } catch { /* SSR guard */ }
    return null;
  });
  const [initialized, setInitialized] = useState(() => {
    try {
      const ls = localStorage.getItem(LS_KEY);
      return ls === "simple" || ls === "advanced";
    } catch { return false; }
  });

  // If no localStorage value, check server config
  useEffect(() => {
    if (initialized) return;
    fetch("/api/simple-mode-config")
      .then(r => r.json())
      .then((data: { default_mode?: string }) => {
        if (data.default_mode === "simple" || data.default_mode === "advanced") {
          setModeState(data.default_mode as DashboardMode);
          try { localStorage.setItem(LS_KEY, data.default_mode); } catch { /* ignore */ }
        }
        // If neither: mode stays null → trigger first-run card
      })
      .catch(() => { /* server unreachable, stay null */ })
      .finally(() => setInitialized(true));
  }, [initialized]);

  const setMode = (newMode: DashboardMode) => {
    setModeState(newMode);
    if (!initialized) setInitialized(true);
    try { localStorage.setItem(LS_KEY, newMode); } catch { /* ignore */ }
    fetch("/api/simple-mode-config", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ default_mode: newMode }),
    }).catch(() => { /* non-blocking fire-and-forget */ });
  };

  return { mode, setMode, initialized };
}
```
  </action>
  <verify>
    <automated>cd C:/Development/cli/maxsim && npm run build:cli 2>&1 | tail -5; cd packages/dashboard && npx tsc --noEmit 2>&1 | head -30</automated>
  </verify>
  <done>
    - index.css has `--color-simple-accent: #14b8a6` in BOTH `:root` and `@theme`
    - `DashboardMode` type exported from lib/types.ts
    - `simple-mode-provider.tsx` exists with `SimpleModeProvider` and `useSimpleMode` exported
    - `use-dashboard-mode.ts` exists with `useDashboardMode` exported
    - TypeScript reports no type errors in the new files
  </done>
</task>

<task type="auto">
  <name>Task 2: Mode toggle button, first-run card, AppShell/Sidebar slot additions, App.tsx wiring, and server config endpoint</name>
  <files>
    packages/dashboard/src/components/simple-mode/mode-toggle-button.tsx
    packages/dashboard/src/components/simple-mode/first-run-card.tsx
    packages/dashboard/src/components/layout/app-shell.tsx
    packages/dashboard/src/components/layout/sidebar.tsx
    packages/dashboard/src/App.tsx
    packages/dashboard/src/server.ts
  </files>
  <action>
First, create the directory: `packages/dashboard/src/components/simple-mode/`

**2a. Create mode-toggle-button.tsx:**

Icon-only button. Current mode icon shown (Globe in Simple, Terminal in Advanced). Spin animation on click via `motion/react` `animate` prop with a state-driven `rotate` variant. Tooltip shows action-oriented text ("Switch to Simple Mode" / "Switch to Advanced Mode"). Use inline SVG for both icons (no lucide-react install needed — consistent with existing codebase style per RESEARCH.md).

```typescript
import { useState } from "react";
import { motion } from "motion/react";
import type { DashboardMode } from "@/lib/types";

interface ModeToggleButtonProps {
  mode: DashboardMode | null;
  onToggle: () => void;
}

export function ModeToggleButton({ mode, onToggle }: ModeToggleButtonProps) {
  const [spinning, setSpinning] = useState(false);

  function handleClick() {
    setSpinning(true);
    onToggle();
    // Reset after animation completes
    setTimeout(() => setSpinning(false), 420);
  }

  const isSimple = mode === "simple";
  const title = isSimple ? "Switch to Advanced Mode" : "Switch to Simple Mode";

  return (
    <button
      type="button"
      onClick={handleClick}
      title={title}
      aria-label={title}
      className="flex h-8 w-8 items-center justify-center text-muted-foreground transition-colors hover:text-foreground"
    >
      <motion.span
        animate={{ rotate: spinning ? 360 : 0 }}
        transition={{ duration: 0.4, ease: "easeInOut" }}
        style={{ display: "flex", alignItems: "center", justifyContent: "center" }}
      >
        {isSimple ? (
          /* Globe icon — shown in Simple Mode */
          <svg className="h-4 w-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
            <circle cx="8" cy="8" r="6" />
            <ellipse cx="8" cy="8" rx="2.5" ry="6" />
            <path d="M2 8h12M3.5 5h9M3.5 11h9" strokeLinecap="round" />
          </svg>
        ) : (
          /* Terminal icon — shown in Advanced Mode */
          <svg className="h-4 w-4" viewBox="0 0 16 16" fill="none" stroke="currentColor" strokeWidth="1.5" aria-hidden="true">
            <rect x="1.5" y="2.5" width="13" height="11" rx="1" />
            <path d="M4 6l2.5 2L4 10M8 10h4" strokeLinecap="round" strokeLinejoin="round" />
          </svg>
        )}
      </motion.span>
    </button>
  );
}
```

**2b. Create first-run-card.tsx:**

Shown when `initialized === true && mode === null`. Non-dismissable — user must click one of two CTAs. Blurred background via `backdrop-blur-sm`. Includes minimal SVG layout illustrations for Simple and Advanced modes.

```typescript
import type { DashboardMode } from "@/lib/types";

interface FirstRunCardProps {
  onChoose: (mode: DashboardMode) => void;
}

export function FirstRunCard({ onChoose }: FirstRunCardProps) {
  return (
    <div className="absolute inset-0 z-50 flex items-center justify-center">
      {/* Blurred backdrop */}
      <div className="absolute inset-0 backdrop-blur-sm bg-background/60" />
      {/* Card */}
      <div className="relative z-10 border border-border bg-card p-8 max-w-lg w-full mx-4">
        <h2 className="font-bold text-lg tracking-tight text-foreground mb-1">Choose Your Dashboard Mode</h2>
        <p className="text-sm text-muted-foreground mb-6">
          You can switch between modes at any time from the header toggle.
        </p>
        <div className="flex gap-4">
          {/* Simple Mode option */}
          <div className="flex-1 border border-border p-4 flex flex-col gap-3">
            {/* SVG illustration — simplified layout (no sidebar, clean card area) */}
            <svg viewBox="0 0 120 70" className="w-full h-auto border border-border/40 bg-muted/20" aria-hidden="true">
              <rect x="0" y="0" width="120" height="12" fill="currentColor" fillOpacity="0.08" />
              <rect x="8" y="3" width="30" height="6" rx="1" fill="#14b8a6" fillOpacity="0.6" />
              <rect x="8" y="18" width="104" height="8" rx="1" fill="currentColor" fillOpacity="0.12" />
              <rect x="8" y="32" width="50" height="30" rx="1" fill="currentColor" fillOpacity="0.08" />
              <rect x="62" y="32" width="50" height="30" rx="1" fill="currentColor" fillOpacity="0.08" />
            </svg>
            <div>
              <p className="text-sm font-medium text-foreground">Simple Mode</p>
              <p className="text-xs text-muted-foreground mt-0.5">Clean action cards. No terminal required.</p>
            </div>
            <button
              type="button"
              onClick={() => onChoose("simple")}
              className="border border-simple-accent bg-simple-accent/10 px-3 py-1.5 text-xs font-mono uppercase tracking-widest text-simple-accent transition-colors hover:bg-simple-accent hover:text-background"
            >
              Use Simple Mode
            </button>
          </div>
          {/* Advanced Mode option */}
          <div className="flex-1 border border-border p-4 flex flex-col gap-3">
            {/* SVG illustration — sidebar + terminal layout */}
            <svg viewBox="0 0 120 70" className="w-full h-auto border border-border/40 bg-muted/20" aria-hidden="true">
              <rect x="0" y="0" width="120" height="70" fill="currentColor" fillOpacity="0.03" />
              <rect x="0" y="0" width="28" height="70" fill="currentColor" fillOpacity="0.08" />
              <rect x="3" y="3" width="22" height="5" rx="1" fill="currentColor" fillOpacity="0.2" />
              <rect x="3" y="12" width="22" height="3" rx="0.5" fill="currentColor" fillOpacity="0.12" />
              <rect x="3" y="18" width="22" height="3" rx="0.5" fill="currentColor" fillOpacity="0.12" />
              <rect x="30" y="4" width="86" height="28" rx="1" fill="currentColor" fillOpacity="0.08" />
              <rect x="30" y="36" width="86" height="28" rx="1" fill="#3b82f6" fillOpacity="0.1" />
              <rect x="33" y="39" width="12" height="2" rx="0.5" fill="#3b82f6" fillOpacity="0.5" />
            </svg>
            <div>
              <p className="text-sm font-medium text-foreground">Advanced Mode</p>
              <p className="text-xs text-muted-foreground mt-0.5">Full dashboard with terminal and phase viewer.</p>
            </div>
            <button
              type="button"
              onClick={() => onChoose("advanced")}
              className="border border-accent bg-accent/10 px-3 py-1.5 text-xs font-mono uppercase tracking-widest text-accent transition-colors hover:bg-accent hover:text-foreground"
            >
              Use Advanced Mode
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
```

**2c. Modify app-shell.tsx — add `headerRight` prop:**

Add `headerRight?: React.ReactNode` to `AppShellProps`. Render it in the mobile top bar between the MAXSIM label and the hamburger button:
```tsx
// Before the hamburger button in the mobile top bar:
{headerRight && (
  <div className="flex items-center gap-2">
    {headerRight}
  </div>
)}
```
The mobile top bar `justify-between` becomes a three-column layout: `[MAXSIM label] [headerRight] [hamburger]`. Adjust flex to `gap-2 items-center` as needed.

**2d. Modify sidebar.tsx — add `logoAction` prop:**

Add `logoAction?: React.ReactNode` to `SidebarProps`. Render it adjacent to the MAXSIM/Dashboard logo area:
```tsx
// In the logo border-b section, add flex row with justify-between:
<div className="border-b border-border px-5 py-4 flex items-center justify-between">
  <button type="button" onClick={() => onNavigate("overview")} className="flex flex-col gap-0.5 text-left">
    <span className="text-sm font-bold tracking-tight text-foreground">MAXSIM</span>
    <span className="text-xs text-muted-foreground">Dashboard</span>
  </button>
  {logoAction}
</div>
```

**2e. Modify App.tsx — wire everything together:**

Major changes to `App.tsx`:
1. Import `SimpleModeProvider` and wrap `DashboardApp`
2. Move `useDashboardMode` into `DashboardApp` (it needs to be inside WebSocketProvider for future phases, but can live in DashboardApp for now)
3. Pass `ModeToggleButton` to `AppShell` `headerRight` and `Sidebar` `logoAction` props
4. Gate sidebar visibility: when `mode === "simple"`, pass `sidebar={null}` or hide via CSS — use `style={{ display: mode === "simple" ? "none" : "flex" }}` wrapper around `AppShell` sidebar slot to keep Advanced Mode mounted but hidden (per anti-pattern warning in RESEARCH.md: do NOT unmount, use CSS)
5. Show `FirstRunCard` when `initialized && mode === null`
6. In Simple Mode, the `<main>` content area is full-width (no sidebar). In Advanced Mode, existing behavior unchanged.
7. Apply teal header accent in Simple Mode: pass a `simpleMode` boolean prop to `AppShell` that conditionally applies `bg-simple-accent/10 border-simple-accent/30` to the mobile top bar background, OR better: apply a CSS class conditionally at the top-level wrapper div. Use `data-mode="simple"` attribute on the root div so the sidebar and header can self-style.

Implementation approach for the mode-gated layout:
```tsx
// In DashboardApp, after existing hooks:
const { mode, setMode, initialized } = useDashboardMode();

const toggleMode = () => setMode(mode === "simple" ? "advanced" : "simple");

const modeToggle = (
  <ModeToggleButton mode={mode} onToggle={toggleMode} />
);

// In the AppShell render, hide sidebar when in simple mode via CSS wrapper:
<AppShell
  mobileMenuOpen={mobileMenuOpen}
  onMobileMenuToggle={...}
  onMobileMenuClose={...}
  headerRight={initialized ? modeToggle : null}
  sidebar={
    <div style={{ display: mode === "simple" ? "none" : "contents" }}>
      <Sidebar
        activeView={activeView}
        activePhaseId={activePhaseId}
        onNavigate={handleNavigate}
        logoAction={initialized ? modeToggle : null}
      />
    </div>
  }
>
  {/* Simple Mode view OR Advanced Mode content */}
  <div className={`relative flex-1 min-h-0 ${mode === "simple" ? "bg-background" : ""}`}>
    {/* First-run card — shown above everything when mode is null */}
    {initialized && mode === null && <FirstRunCard onChoose={setMode} />}

    {/* Simple Mode content area (Plan 02 will fill this with SimpleModeView) */}
    {mode === "simple" && initialized && (
      <div className="flex-1 overflow-y-auto p-4 sm:p-6">
        {/* SimpleModeView placeholder — Plan 02 replaces this */}
        <p className="text-sm text-muted-foreground font-mono">Simple Mode — action screen coming in Plan 02</p>
      </div>
    )}

    {/* Advanced Mode content — always mounted, hidden in Simple Mode */}
    <div style={{ display: mode === "simple" ? "none" : "contents" }}>
      {/* existing dashboard content div and terminal div */}
    </div>
  </div>
</AppShell>
```

Apply teal accent to the AppShell mobile top bar in Simple Mode by adding `headerSimpleMode` boolean prop to AppShell:
```tsx
// app-shell.tsx mobile top bar div:
<div className={cn(
  "flex shrink-0 items-center justify-between border-b border-border bg-card px-4 py-3 md:hidden",
  simpleMode && "border-simple-accent/30 bg-simple-accent/5"
)}>
```
For the desktop sidebar header area, the teal accent is applied in `sidebar.tsx` via a `simpleMode?: boolean` prop on the logo div.

Note: Since the sidebar is hidden via CSS wrapper in Simple Mode, the desktop teal accent applies when mode toggles back to Simple. A simpler approach: apply the teal accent to the AppShell root wrapper `data-mode` attribute and use a Tailwind `data-[mode=simple]:` variant if Tailwind v4 supports it — but safer to just pass the boolean prop explicitly.

**2f. Add /api/simple-mode-config endpoints to server.ts:**

Find the existing API routes section in server.ts (after the last `app.get` or `app.post` route, before `app.use(sirv(...))` or the `main()` function). Add:

```typescript
// ─── Simple Mode Config ───────────────────────────────────────────────────

const simpleModeConfigPath = path.join(__dirname, 'simple-mode-config.json');

app.get('/api/simple-mode-config', (_req: Request, res: Response) => {
  try {
    if (!fs.existsSync(simpleModeConfigPath)) {
      return res.json({});
    }
    const data = JSON.parse(fs.readFileSync(simpleModeConfigPath, 'utf-8'));
    return res.json(data);
  } catch {
    return res.json({});
  }
});

app.post('/api/simple-mode-config', (req: Request, res: Response) => {
  const { default_mode } = req.body as { default_mode?: string };
  if (default_mode !== 'simple' && default_mode !== 'advanced') {
    return res.status(400).json({ error: 'default_mode must be "simple" or "advanced"' });
  }
  let existing: Record<string, unknown> = {};
  if (fs.existsSync(simpleModeConfigPath)) {
    try { existing = JSON.parse(fs.readFileSync(simpleModeConfigPath, 'utf-8')); } catch { /* ignore */ }
  }
  existing.default_mode = default_mode;
  fs.writeFileSync(simpleModeConfigPath, JSON.stringify(existing, null, 2), 'utf-8');
  log('INFO', 'simple-mode-config', `default_mode set to ${default_mode}`);
  return res.json({ written: true, default_mode });
});
```
  </action>
  <verify>
    <automated>cd C:/Development/cli/maxsim && npm run build 2>&1 | tail -20</automated>
  </verify>
  <done>
    - `packages/dashboard/src/components/simple-mode/` directory exists with `mode-toggle-button.tsx` and `first-run-card.tsx`
    - AppShell accepts `headerRight` and `simpleMode` props; mobile top bar shows teal accent in Simple Mode
    - Sidebar accepts `logoAction` and `simpleMode` props; logo area shows toggle button on desktop
    - App.tsx wraps with `SimpleModeProvider`; uses `useDashboardMode`; renders `FirstRunCard` when mode is null; hides sidebar+terminal in Simple Mode via CSS
    - server.ts has `GET /api/simple-mode-config` and `POST /api/simple-mode-config` routes
    - `npm run build` completes without errors
    - Opening the dashboard: first-time user sees the welcome card; clicking "Use Simple Mode" switches to teal header, no sidebar; toggle button in header switches back; preference persists on refresh
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Run `npm run build` — must complete with exit code 0
2. TypeScript: `cd packages/dashboard && npx tsc --noEmit` — no errors
3. Manual check (start dashboard): `node packages/dashboard/dist/server.js` (or `npm run dev` in dashboard package)
   - Visit http://localhost:3333
   - First load: welcome card appears with blurred background; two CTA buttons visible
   - Click "Use Simple Mode": header turns teal, sidebar disappears, toggle button shows Globe icon
   - Click toggle: spinner animation, switches to Advanced Mode (blue header, sidebar visible), Terminal icon shown
   - Refresh page: Simple Mode preference persisted (no welcome card shown again)
   - Clear localStorage, refresh: server config used (still no welcome card if server config was written)
</verification>

<success_criteria>
- `SimpleModeProvider` wraps `DashboardApp` in App.tsx
- `useDashboardMode` hook reads localStorage synchronously (no first-run flash for returning users)
- Mode toggle button visible in both mobile top bar and desktop sidebar logo area
- Spin animation fires on every toggle click (one-shot, ~400ms)
- Simple Mode: header background shifts to teal (`bg-simple-accent/5` or similar), sidebar hidden via CSS, terminal hidden
- Advanced Mode: original blue accent, sidebar visible, full terminal access
- First-run card: non-dismissable, blurred backdrop, two CTAs that call `setMode`
- `POST /api/simple-mode-config` writes to `simple-mode-config.json` in `__dirname` (merge, not overwrite)
- Full build passes: `npm run build` exit 0
</success_criteria>

<output>
After completion, create `.planning/phases/31-simple-mode-ui-shell/31-01-SUMMARY.md`
</output>
