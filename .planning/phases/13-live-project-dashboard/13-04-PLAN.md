---
phase: 13-live-project-dashboard
plan: 04
type: execute
wave: 3
depends_on: ["13-02", "13-03"]
files_modified:
  - packages/dashboard/app/page.tsx
  - packages/dashboard/app/components/dashboard/stats-header.tsx
  - packages/dashboard/app/components/dashboard/phase-list.tsx
  - packages/dashboard/app/components/dashboard/phase-progress.tsx
  - packages/dashboard/app/hooks/use-dashboard-data.ts
autonomous: true
requirements: []

must_haves:
  truths:
    - "Dashboard main page shows an at-a-glance stats header with milestone progress %, current phase, open blockers count, open todos count"
    - "Phase overview lists all phases vertically with individual animated progress bars, plan counts, and status icons"
    - "Current phase is visually highlighted with an accent border/glow"
    - "Data refreshes automatically when files change (via WebSocket lastChange trigger)"
    - "Swiss Style Design: strong grid, clean mono+sans typography, dark theme, data-dense"
  artifacts:
    - path: "packages/dashboard/app/page.tsx"
      provides: "Main dashboard page composing stats header + phase list"
      min_lines: 30
    - path: "packages/dashboard/app/components/dashboard/stats-header.tsx"
      provides: "Header bar with milestone progress, current phase, blockers badge, todos badge"
      min_lines: 40
    - path: "packages/dashboard/app/components/dashboard/phase-list.tsx"
      provides: "Vertical list of all phases with progress bars and status"
      min_lines: 40
    - path: "packages/dashboard/app/components/dashboard/phase-progress.tsx"
      provides: "Individual phase card with animated progress bar, plan count, status"
      min_lines: 30
    - path: "packages/dashboard/app/hooks/use-dashboard-data.ts"
      provides: "Custom hook that fetches roadmap/state/todos and refetches on WebSocket lastChange"
      min_lines: 30
      exports: ["useDashboardData"]
  key_links:
    - from: "packages/dashboard/app/hooks/use-dashboard-data.ts"
      to: "packages/dashboard/app/components/providers/websocket-provider.tsx"
      via: "useWebSocket() for lastChange trigger"
      pattern: "useWebSocket"
    - from: "packages/dashboard/app/hooks/use-dashboard-data.ts"
      to: "/api/roadmap"
      via: "fetch() call"
      pattern: "fetch.*api/roadmap"
    - from: "packages/dashboard/app/page.tsx"
      to: "packages/dashboard/app/components/dashboard/stats-header.tsx"
      via: "component composition"
      pattern: "<StatsHeader"
    - from: "packages/dashboard/app/components/dashboard/phase-progress.tsx"
      to: "motion/react"
      via: "motion.div for animated progress bar"
      pattern: "motion"
---

<objective>
Build the primary dashboard view: stats header and phase overview with animated progress bars.

Purpose: Deliver the main "mission control" view that shows at-a-glance project status — the most important screen the user sees when opening the dashboard.
Output: A data-dense dashboard page with real-time milestone stats header, vertical phase list with animated progress bars, and auto-refreshing data tied to WebSocket file change events.
</objective>

<execution_context>
@./workflows/execute-plan.md
@./templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/13-live-project-dashboard/13-CONTEXT.md
@.planning/phases/13-live-project-dashboard/13-RESEARCH.md
@.planning/phases/13-live-project-dashboard/13-01-SUMMARY.md
@.planning/phases/13-live-project-dashboard/13-02-SUMMARY.md
@.planning/phases/13-live-project-dashboard/13-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useDashboardData hook and stats header component</name>
  <files>
    packages/dashboard/app/hooks/use-dashboard-data.ts
    packages/dashboard/app/components/dashboard/stats-header.tsx
  </files>
  <action>
  1. **app/hooks/use-dashboard-data.ts** — "use client" custom hook:
     - Uses `useWebSocket()` to get `lastChange` timestamp
     - Fetches from `/api/roadmap`, `/api/state`, `/api/todos` on mount
     - Re-fetches when `lastChange` changes (useEffect dependency)
     - Returns: `{ roadmap, state, todos, loading, error }`
     - Uses `useState` + `useEffect` pattern (not SWR/react-query — keep deps minimal)
     - Includes a `fetchAll()` function that runs all 3 fetches in `Promise.all()`
     - Handles loading and error states gracefully

  2. **app/components/dashboard/stats-header.tsx** — "use client" component:
     - Receives `roadmap` and `state` and `todos` as props (from parent page)
     - Displays in a horizontal bar (flex row, items-center, gap-8):
       - **Milestone progress**: Large progress bar (motion.div animated width) with percentage text
       - **Current phase**: Phase number + name, highlighted in accent color
       - **Open blockers**: Count badge in danger color (red glow if > 0)
       - **Open todos**: Count badge in warning color
     - Typography: Phase numbers in `font-mono`, labels in `font-sans`
     - Swiss Style: Strong left alignment, minimal decoration, high information density
     - Use Tailwind v4 theme variables (bg-card, text-foreground, border-border, etc.)
     - Connection status indicator: small green/red dot using `useWebSocket().connected`
  </action>
  <verify>
    <automated>cd C:/Development/cli/maxsim/packages/dashboard && npx next build 2>&1 | tail -5</automated>
  </verify>
  <done>useDashboardData hook fetches from all 3 API endpoints and refetches on WebSocket changes; stats header shows milestone progress bar, current phase, blockers badge, todos badge with Swiss Style typography</done>
</task>

<task type="auto">
  <name>Task 2: Create phase list and phase progress components, wire into main page</name>
  <files>
    packages/dashboard/app/components/dashboard/phase-list.tsx
    packages/dashboard/app/components/dashboard/phase-progress.tsx
    packages/dashboard/app/page.tsx
  </files>
  <action>
  1. **app/components/dashboard/phase-progress.tsx** — "use client" component:
     - Props: `phaseName`, `phaseNumber`, `completedPlans`, `totalPlans`, `status`, `isCurrent`, `onClick`
     - Animated progress bar using `motion` from `motion/react`:
       - `motion.div` with `initial={{ width: 0 }}`, `animate={{ width: "${pct}%" }}`, `transition={{ duration: 0.5, ease: "easeOut" }}`
       - Bar height: `h-2`, rounded, accent color for fill, muted for background
     - Status icon: checkmark for complete, spinner/dot for in-progress, empty for planned
     - Phase number in mono font, phase name in sans, plan count as `{completed}/{total}`
     - Current phase: accent border-left (4px) and subtle card-hover background
     - Clickable: calls `onClick(phaseNumber)` for drill-down navigation
     - Status color coding: complete=success, in-progress=accent, planned=muted-foreground

  2. **app/components/dashboard/phase-list.tsx** — "use client" component:
     - Props: `phases: DashboardPhase[]`, `currentPhase: string | null`, `onPhaseClick: (id: string) => void`
     - Maps over phases, renders `PhaseProgress` for each
     - Vertical stack with consistent spacing (space-y-3)
     - Section header: "Phases" in mono font, total count on the right

  3. **app/page.tsx** — Main dashboard page (Server Component shell + Client Component):
     - Create a `DashboardContent` client component within or alongside page.tsx
     - Uses `useDashboardData()` hook
     - Layout: vertical stack
       - `<StatsHeader>` at top
       - `<PhaseList>` below filling remaining space
     - Loading state: skeleton placeholders (pulsing muted rectangles)
     - Error state: error message with retry button
     - Phase click handler: sets selected phase state (for Plan 05 drill-down — store in URL search params or state for now)
  </action>
  <verify>
    <automated>cd C:/Development/cli/maxsim/packages/dashboard && npx next build 2>&1 | tail -5</automated>
  </verify>
  <done>Main page renders stats header + phase list with animated progress bars, current phase is highlighted, phases are clickable for drill-down, loading/error states handled</done>
</task>

</tasks>

<verification>
1. `npx next build` succeeds
2. Main page imports and renders StatsHeader and PhaseList components
3. useDashboardData hook triggers refetch when lastChange from WebSocket changes
4. PhaseProgress component uses motion for animated progress bar
5. Swiss Style Design: mono font for numbers, sans for labels, dark theme colors, data-dense layout
</verification>

<success_criteria>
- Dashboard main page shows real-time project stats at a glance
- Phase overview lists all phases with animated progress bars and status icons
- Current phase is visually highlighted with accent border
- Data auto-refreshes via WebSocket file change events
- Clean Swiss Style Design with proper typography hierarchy
</success_criteria>

<output>
After completion, create `.planning/phases/13-live-project-dashboard/13-04-SUMMARY.md`
</output>
