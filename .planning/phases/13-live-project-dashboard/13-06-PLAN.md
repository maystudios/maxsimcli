---
phase: 13-live-project-dashboard
plan: 06
type: execute
wave: 4
depends_on: ["13-04", "13-05"]
files_modified:
  - packages/dashboard/app/components/layout/sidebar.tsx
  - packages/dashboard/app/components/layout/app-shell.tsx
  - packages/dashboard/app/components/dashboard/todos-panel.tsx
  - packages/dashboard/app/components/dashboard/blockers-panel.tsx
  - packages/dashboard/app/components/dashboard/state-editor.tsx
  - packages/dashboard/app/page.tsx
autonomous: true
requirements: []

must_haves:
  truths:
    - "Sidebar navigation shows phase list as main nav, with todos and blockers accessible as dedicated views"
    - "Todos panel shows pending and completed todos, allows creating new todos and marking as complete"
    - "Blockers panel shows active blockers with resolve capability"
    - "STATE.md decisions and blockers can be added from the dashboard"
    - "App shell provides consistent layout: sidebar + main content area"
  artifacts:
    - path: "packages/dashboard/app/components/layout/sidebar.tsx"
      provides: "Navigation sidebar with phase list, todos count badge, blockers count badge"
      min_lines: 50
    - path: "packages/dashboard/app/components/layout/app-shell.tsx"
      provides: "App shell layout: sidebar + scrollable main content area"
      min_lines: 30
    - path: "packages/dashboard/app/components/dashboard/todos-panel.tsx"
      provides: "Todos view with pending/completed lists, add new todo, mark complete"
      min_lines: 50
    - path: "packages/dashboard/app/components/dashboard/blockers-panel.tsx"
      provides: "Blockers view with active blockers and resolve action"
      min_lines: 40
    - path: "packages/dashboard/app/components/dashboard/state-editor.tsx"
      provides: "Form for adding decisions and blockers to STATE.md"
      min_lines: 40
  key_links:
    - from: "packages/dashboard/app/components/layout/sidebar.tsx"
      to: "packages/dashboard/app/hooks/use-dashboard-data.ts"
      via: "useDashboardData for phase list and counts"
      pattern: "useDashboardData"
    - from: "packages/dashboard/app/components/dashboard/todos-panel.tsx"
      to: "/api/todos"
      via: "POST for new todo, PATCH for completion"
      pattern: "fetch.*api/todos"
    - from: "packages/dashboard/app/components/dashboard/blockers-panel.tsx"
      to: "/api/state"
      via: "PATCH for blocker resolution"
      pattern: "fetch.*api/state"
    - from: "packages/dashboard/app/components/layout/app-shell.tsx"
      to: "packages/dashboard/app/components/layout/sidebar.tsx"
      via: "component composition"
      pattern: "<Sidebar"
    - from: "packages/dashboard/app/page.tsx"
      to: "packages/dashboard/app/components/dashboard/phase-detail.tsx"
      via: "conditional render when activeView === 'phase'"
      pattern: "<PhaseDetail"
    - from: "packages/dashboard/app/page.tsx"
      to: "packages/dashboard/app/components/dashboard/stats-header.tsx"
      via: "activeView routing state renders StatsHeader in overview view"
      pattern: "<StatsHeader"
    - from: "packages/dashboard/app/page.tsx"
      to: "packages/dashboard/app/components/dashboard/phase-list.tsx"
      via: "activeView routing state renders PhaseList in overview view"
      pattern: "<PhaseList"
---

<objective>
Build the navigation sidebar, app shell layout, todos panel, blockers panel, and state editing capability.

Purpose: Complete the dashboard's information architecture by adding sidebar navigation and dedicated views for todos and blockers — the secondary but important data views that make the dashboard a complete project management surface.
Output: A sidebar-based layout with phase navigation, todos panel with CRUD, blockers panel with resolve, and STATE.md editing.
</objective>

<execution_context>
@./workflows/execute-plan.md
@./templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/13-live-project-dashboard/13-CONTEXT.md
@.planning/phases/13-live-project-dashboard/13-04-SUMMARY.md
@.planning/phases/13-live-project-dashboard/13-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sidebar navigation and app shell layout</name>
  <files>
    packages/dashboard/app/components/layout/sidebar.tsx
    packages/dashboard/app/components/layout/app-shell.tsx
    packages/dashboard/app/page.tsx
  </files>
  <action>
  1. **app/components/layout/sidebar.tsx** — "use client" component:
     - Uses `useDashboardData()` for phase list, todos count, blockers count
     - Layout: Fixed-width sidebar (w-64), dark bg-card, full height
     - Sections:
       a. **Logo/Title**: "MAXSIM" in mono font bold, small version number below
       b. **Main nav** — Phase list:
          - Each phase: number + abbreviated name, truncated
          - Status dot: green=complete, blue=in-progress, gray=planned
          - Current phase highlighted with accent-glow left border
          - Clicking navigates to phase (calls `onNavigate("phase", phaseId)`)
       c. **Secondary nav** — Two items:
          - "Todos" with count badge (warning color if > 0)
          - "Blockers" with count badge (danger color if > 0)
       d. **Footer** — Connection status dot + "Connected"/"Disconnected" text using `useWebSocket()`
     - Props: `activeView`, `activePhaseId`, `onNavigate: (view: string, id?: string) => void`

  2. **app/components/layout/app-shell.tsx** — "use client" component:
     - Props: `children`, `sidebar` (or compose internally)
     - Layout: `flex h-screen` — sidebar on left, main content scrollable on right
     - Main content: `flex-1 overflow-y-auto p-6`
     - Responsive: On small screens, sidebar collapses to icon-only or hamburger menu

  3. **app/page.tsx** — Update to use app shell and routing:
     - Wrap in `<AppShell>` with `<Sidebar>`
     - Manage `activeView` state: "overview" | "phase" | "todos" | "blockers"
     - Manage `activePhaseId` state
     - Conditional rendering:
       - "overview": `<StatsHeader>` + `<PhaseList>` (existing from Plan 04)
       - "phase": `<PhaseDetail phaseId={activePhaseId}>` (from Plan 05)
       - "todos": `<TodosPanel>` (created in Task 2)
       - "blockers": `<BlockersPanel>` (created in Task 2)
     - Phase click from overview or sidebar sets view to "phase"
     - Back button in PhaseDetail sets view to "overview"
  </action>
  <verify>
    <automated>cd C:/Development/cli/maxsim/packages/dashboard && npx next build 2>&1 | tail -5</automated>
  </verify>
  <done>Sidebar shows phase list with status dots and count badges; app shell provides sidebar + main content layout; routing between overview/phase/todos/blockers views works</done>
</task>

<task type="auto">
  <name>Task 2: Create todos panel, blockers panel, and state editor</name>
  <files>
    packages/dashboard/app/components/dashboard/todos-panel.tsx
    packages/dashboard/app/components/dashboard/blockers-panel.tsx
    packages/dashboard/app/components/dashboard/state-editor.tsx
  </files>
  <action>
  1. **app/components/dashboard/todos-panel.tsx** — "use client" component:
     - Fetches todos from `/api/todos`
     - Refreshes on `useWebSocket().lastChange`
     - Layout: Two sections — "Pending" and "Completed" (collapsed by default)
     - Each todo: checkbox + text, clicking checkbox calls PATCH `/api/todos` with `{ file, completed: true }`
     - "Add Todo" button/input at top: text input + submit, calls POST `/api/todos` with `{ text }`
     - Pending count in header
     - Empty state: "No pending todos" with muted text

  2. **app/components/dashboard/blockers-panel.tsx** — "use client" component:
     - Reads blockers from `useDashboardData()` state (state.blockers parsed from STATE.md)
     - Shows active (non-resolved) blockers with:
       - Blocker text, source/phase tag, timestamp
       - "Resolve" button that calls PATCH `/api/state` with `{ field: "blockers", action: "resolve", text: blockerText }`
     - Resolved blockers: shown in a collapsed "Resolved" section with strikethrough
     - "Add Blocker" form: text input + submit
     - Empty state: "No active blockers" in success color

  3. **app/components/dashboard/state-editor.tsx** — "use client" component:
     - Small form panel for adding entries to STATE.md:
       - "Add Decision" tab: phase input, text input → PATCH `/api/state` with `{ field: "decisions", action: "add", phase, text }`
       - "Add Blocker" tab: text input → PATCH `/api/state` with `{ field: "blockers", action: "add", text }`
     - Shows within the blockers panel as an expandable section
     - Minimal styling: border-top separator, compact form fields
  </action>
  <verify>
    <automated>cd C:/Development/cli/maxsim/packages/dashboard && npx next build 2>&1 | tail -5</automated>
  </verify>
  <done>Todos panel shows pending/completed with add and toggle; blockers panel shows active blockers with resolve; state editor allows adding decisions and blockers to STATE.md</done>
</task>

</tasks>

<verification>
1. `npx next build` succeeds with all layout and panel components
2. Sidebar navigation switches between overview, phase detail, todos, and blockers views
3. Todo creation via POST and completion via PATCH work
4. Blocker resolution updates STATE.md via PATCH
5. App shell provides consistent sidebar + content layout
</verification>

<success_criteria>
- Sidebar navigation with phase list, todos badge, blockers badge
- App shell with sidebar + scrollable main content
- Todos panel with CRUD (create, complete, view pending/completed)
- Blockers panel with active/resolved and resolve action
- STATE.md editing for decisions and blockers
- Views route correctly: overview, phase detail, todos, blockers
</success_criteria>

<output>
After completion, create `.planning/phases/13-live-project-dashboard/13-06-SUMMARY.md`
</output>
