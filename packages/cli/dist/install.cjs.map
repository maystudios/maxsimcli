{"version":3,"file":"install.cjs","names":["path","os","path","os","path","os","path","os","path","claudeAdapter","opencodeAdapter","geminiAdapter","codexAdapter","fs","os","crypto","readline"],"sources":["../../adapters/dist/base.js","../../adapters/dist/claude.js","../../adapters/dist/transforms/tool-maps.js","../../adapters/dist/transforms/content.js","../../adapters/dist/transforms/frontmatter.js","../../adapters/dist/opencode.js","../../adapters/dist/gemini.js","../../adapters/dist/codex.js","../../adapters/dist/index.js","../package.json","../src/install.ts"],"sourcesContent":["\"use strict\";\n/**\n * @maxsim/adapters — Shared base utilities extracted from bin/install.js\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.expandTilde = expandTilde;\nexports.extractFrontmatterAndBody = extractFrontmatterAndBody;\nexports.processAttribution = processAttribution;\nexports.buildHookCommand = buildHookCommand;\nexports.readSettings = readSettings;\nexports.writeSettings = writeSettings;\nconst path = __importStar(require(\"node:path\"));\nconst os = __importStar(require(\"node:os\"));\nconst fs = __importStar(require(\"node:fs\"));\n/**\n * Expand ~ to home directory (shell doesn't expand in env vars passed to node)\n */\nfunction expandTilde(filePath) {\n    if (filePath && filePath.startsWith('~/')) {\n        return path.join(os.homedir(), filePath.slice(2));\n    }\n    return filePath;\n}\n/**\n * Extract YAML frontmatter and body from markdown content.\n * Returns null frontmatter if content doesn't start with ---.\n */\nfunction extractFrontmatterAndBody(content) {\n    if (!content.startsWith('---')) {\n        return { frontmatter: null, body: content };\n    }\n    const endIndex = content.indexOf('---', 3);\n    if (endIndex === -1) {\n        return { frontmatter: null, body: content };\n    }\n    return {\n        frontmatter: content.substring(3, endIndex).trim(),\n        body: content.substring(endIndex + 3),\n    };\n}\n/**\n * Process Co-Authored-By lines based on attribution setting.\n * @param content - File content to process\n * @param attribution - null=remove, undefined=keep default, string=replace\n */\nfunction processAttribution(content, attribution) {\n    if (attribution === null) {\n        return content.replace(/(\\r?\\n){2}Co-Authored-By:.*$/gim, '');\n    }\n    if (attribution === undefined) {\n        return content;\n    }\n    const safeAttribution = attribution.replace(/\\$/g, '$$$$');\n    return content.replace(/Co-Authored-By:.*$/gim, `Co-Authored-By: ${safeAttribution}`);\n}\n/**\n * Build a hook command path using forward slashes for cross-platform compatibility.\n */\nfunction buildHookCommand(configDir, hookName) {\n    const hooksPath = configDir.replace(/\\\\/g, '/') + '/hooks/' + hookName;\n    return `node \"${hooksPath}\"`;\n}\n/**\n * Read and parse settings.json, returning empty object if it doesn't exist.\n */\nfunction readSettings(settingsPath) {\n    if (fs.existsSync(settingsPath)) {\n        try {\n            return JSON.parse(fs.readFileSync(settingsPath, 'utf8'));\n        }\n        catch {\n            return {};\n        }\n    }\n    return {};\n}\n/**\n * Write settings.json with proper formatting.\n */\nfunction writeSettings(settingsPath, settings) {\n    fs.writeFileSync(settingsPath, JSON.stringify(settings, null, 2) + '\\n');\n}\n//# sourceMappingURL=base.js.map","\"use strict\";\n/**\n * @maxsim/adapters — Claude Code adapter\n *\n * Ports the Claude-specific logic from bin/install.js:\n *   - getGlobalDir('claude', ...)  (lines 135-142)\n *   - getDirName('claude')         (line 49)\n *   - getConfigDirFromHome('claude', isGlobal) (lines 58-72)\n *   - copyWithPathReplacement for Claude (lines 839-892)\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.claudeAdapter = void 0;\nexports.installClaude = installClaude;\nconst path = __importStar(require(\"node:path\"));\nconst os = __importStar(require(\"node:os\"));\nconst base_js_1 = require(\"./base.js\");\n/**\n * Get the global config directory for Claude Code.\n * Priority: explicitDir > CLAUDE_CONFIG_DIR env > ~/.claude\n */\nfunction getGlobalDir(explicitDir) {\n    if (explicitDir) {\n        return (0, base_js_1.expandTilde)(explicitDir);\n    }\n    if (process.env.CLAUDE_CONFIG_DIR) {\n        return (0, base_js_1.expandTilde)(process.env.CLAUDE_CONFIG_DIR);\n    }\n    return path.join(os.homedir(), '.claude');\n}\n/**\n * Get the config directory path relative to home for hook templating.\n * Used for path.join(homeDir, '<configDir>', ...) replacement in hooks.\n */\nfunction getConfigDirFromHome(isGlobal) {\n    // Both global and local use '.claude' for Claude Code\n    return \"'.claude'\";\n}\n/**\n * Transform markdown content for Claude Code installation.\n * For Claude, this is path replacement only — no frontmatter conversion needed.\n * Replaces ~/.claude/ and ./.claude/ references with the actual install path prefix.\n */\nfunction transformContent(content, pathPrefix) {\n    const globalClaudeRegex = /~\\/\\.claude\\//g;\n    const localClaudeRegex = /\\.\\/\\.claude\\//g;\n    let result = content.replace(globalClaudeRegex, pathPrefix);\n    result = result.replace(localClaudeRegex, `./.claude/`);\n    return result;\n}\n/**\n * Claude Code adapter configuration.\n * Claude uses nested command structure (commands/maxsim/*.md).\n */\nexports.claudeAdapter = {\n    runtime: 'claude',\n    dirName: '.claude',\n    getGlobalDir,\n    getConfigDirFromHome,\n    transformContent,\n    commandStructure: 'nested',\n};\n/**\n * Install Claude Code adapter files.\n * Stub — actual install orchestration will be implemented in Phase 5.\n */\nfunction installClaude() {\n    // Phase 5 will implement the full install orchestration.\n    // The adapter exposes this function per CONTEXT.md decision.\n    throw new Error('installClaude() not yet implemented — see Phase 5');\n}\n//# sourceMappingURL=claude.js.map","\"use strict\";\n/**\n * @maxsim/adapters — Tool name mappings per runtime\n *\n * Ported from bin/install.js lines ~327-390\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.convertToolName = convertToolName;\nexports.convertGeminiToolName = convertGeminiToolName;\n/** Tool name mapping from Claude Code to OpenCode */\nconst claudeToOpencodeTools = {\n    AskUserQuestion: 'question',\n    SlashCommand: 'skill',\n    TodoWrite: 'todowrite',\n    WebFetch: 'webfetch',\n    WebSearch: 'websearch',\n};\n/** Tool name mapping from Claude Code to Gemini CLI */\nconst claudeToGeminiTools = {\n    Read: 'read_file',\n    Write: 'write_file',\n    Edit: 'replace',\n    Bash: 'run_shell_command',\n    Glob: 'glob',\n    Grep: 'search_file_content',\n    WebSearch: 'google_web_search',\n    WebFetch: 'web_fetch',\n    TodoWrite: 'write_todos',\n    AskUserQuestion: 'ask_user',\n};\n/**\n * Convert a Claude Code tool name to OpenCode format.\n * - Applies special mappings (AskUserQuestion -> question, etc.)\n * - Converts to lowercase (except MCP tools which keep their format)\n */\nfunction convertToolName(claudeTool) {\n    if (claudeToOpencodeTools[claudeTool]) {\n        return claudeToOpencodeTools[claudeTool];\n    }\n    if (claudeTool.startsWith('mcp__')) {\n        return claudeTool;\n    }\n    return claudeTool.toLowerCase();\n}\n/**\n * Convert a Claude Code tool name to Gemini CLI format.\n * - Applies Claude->Gemini mapping (Read->read_file, Bash->run_shell_command, etc.)\n * - Filters out MCP tools (mcp__*) -- auto-discovered at runtime in Gemini\n * - Filters out Task -- agents are auto-registered as tools in Gemini\n * @returns Gemini tool name, or null if tool should be excluded\n */\nfunction convertGeminiToolName(claudeTool) {\n    if (claudeTool.startsWith('mcp__')) {\n        return null;\n    }\n    if (claudeTool === 'Task') {\n        return null;\n    }\n    if (claudeToGeminiTools[claudeTool]) {\n        return claudeToGeminiTools[claudeTool];\n    }\n    return claudeTool.toLowerCase();\n}\n//# sourceMappingURL=tool-maps.js.map","\"use strict\";\n/**\n * @maxsim/adapters — Content transformation utilities\n *\n * Ported from bin/install.js lines ~423-564\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.convertSlashCommandsToCodexSkillMentions = convertSlashCommandsToCodexSkillMentions;\nexports.convertClaudeToCodexMarkdown = convertClaudeToCodexMarkdown;\nexports.stripSubTags = stripSubTags;\nexports.convertClaudeToGeminiAgent = convertClaudeToGeminiAgent;\nexports.replacePathReferences = replacePathReferences;\nconst tool_maps_js_1 = require(\"./tool-maps.js\");\n/**\n * Convert /maxsim:command-name to $maxsim-command-name for Codex skill mentions.\n * Ported from install.js line ~423\n */\nfunction convertSlashCommandsToCodexSkillMentions(content) {\n    let converted = content.replace(/\\/maxsim:([a-z0-9-]+)/gi, (_, commandName) => {\n        return `$maxsim-${String(commandName).toLowerCase()}`;\n    });\n    converted = converted.replace(/\\/maxsim-help\\b/g, '$maxsim-help');\n    return converted;\n}\n/**\n * Convert Claude markdown to Codex markdown format.\n * Replaces slash commands and $ARGUMENTS placeholder.\n * Ported from install.js line ~431\n */\nfunction convertClaudeToCodexMarkdown(content) {\n    let converted = convertSlashCommandsToCodexSkillMentions(content);\n    converted = converted.replace(/\\$ARGUMENTS\\b/g, '{{MAXSIM_ARGS}}');\n    return converted;\n}\n/**\n * Strip HTML <sub> tags for Gemini CLI output.\n * Terminals don't support subscript -- converts <sub>text</sub> to italic *(text)*.\n * Ported from install.js line ~474\n */\nfunction stripSubTags(content) {\n    return content.replace(/<sub>(.*?)<\\/sub>/g, '*($1)*');\n}\n/**\n * Convert Claude Code agent frontmatter to Gemini CLI format.\n * - tools: must be a YAML array (not comma-separated string)\n * - tool names: must use Gemini built-in names (read_file, not Read)\n * - color: must be removed (causes validation error)\n * - mcp__* tools: must be excluded (auto-discovered at runtime)\n * - ${VAR} patterns: escaped to $VAR for Gemini template compatibility\n *\n * Ported from install.js line ~487\n */\nfunction convertClaudeToGeminiAgent(content) {\n    if (!content.startsWith('---'))\n        return content;\n    const endIndex = content.indexOf('---', 3);\n    if (endIndex === -1)\n        return content;\n    const frontmatter = content.substring(3, endIndex).trim();\n    const body = content.substring(endIndex + 3);\n    const lines = frontmatter.split('\\n');\n    const newLines = [];\n    let inAllowedTools = false;\n    const tools = [];\n    for (const line of lines) {\n        const trimmed = line.trim();\n        if (trimmed.startsWith('allowed-tools:')) {\n            inAllowedTools = true;\n            continue;\n        }\n        if (trimmed.startsWith('tools:')) {\n            const toolsValue = trimmed.substring(6).trim();\n            if (toolsValue) {\n                const parsed = toolsValue.split(',').map((t) => t.trim()).filter((t) => t);\n                for (const t of parsed) {\n                    const mapped = (0, tool_maps_js_1.convertGeminiToolName)(t);\n                    if (mapped)\n                        tools.push(mapped);\n                }\n            }\n            else {\n                inAllowedTools = true;\n            }\n            continue;\n        }\n        if (trimmed.startsWith('color:'))\n            continue;\n        if (inAllowedTools) {\n            if (trimmed.startsWith('- ')) {\n                const mapped = (0, tool_maps_js_1.convertGeminiToolName)(trimmed.substring(2).trim());\n                if (mapped)\n                    tools.push(mapped);\n                continue;\n            }\n            else if (trimmed && !trimmed.startsWith('-')) {\n                inAllowedTools = false;\n            }\n        }\n        if (!inAllowedTools) {\n            newLines.push(line);\n        }\n    }\n    if (tools.length > 0) {\n        newLines.push('tools:');\n        for (const tool of tools) {\n            newLines.push(`  - ${tool}`);\n        }\n    }\n    const newFrontmatter = newLines.join('\\n').trim();\n    // Escape ${VAR} patterns in agent body for Gemini CLI compatibility.\n    const escapedBody = body.replace(/\\$\\{(\\w+)\\}/g, '$$$1');\n    return `---\\n${newFrontmatter}\\n---${stripSubTags(escapedBody)}`;\n}\n/**\n * Replace path references in markdown content for a target runtime.\n * Replaces ~/.claude/ with pathPrefix and ./.claude/ with ./dirName/.\n */\nfunction replacePathReferences(content, pathPrefix, dirName) {\n    const globalClaudeRegex = /~\\/\\.claude\\//g;\n    const localClaudeRegex = /\\.\\/\\.claude\\//g;\n    let result = content.replace(globalClaudeRegex, pathPrefix);\n    result = result.replace(localClaudeRegex, `./${dirName}/`);\n    return result;\n}\n//# sourceMappingURL=content.js.map","\"use strict\";\n/**\n * @maxsim/adapters — Frontmatter conversion functions for opencode, gemini, codex\n *\n * Ported from bin/install.js lines ~308-711\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.colorNameToHex = void 0;\nexports.toSingleLine = toSingleLine;\nexports.yamlQuote = yamlQuote;\nexports.extractFrontmatterField = extractFrontmatterField;\nexports.convertClaudeToOpencodeFrontmatter = convertClaudeToOpencodeFrontmatter;\nexports.convertClaudeToGeminiToml = convertClaudeToGeminiToml;\nexports.convertClaudeCommandToCodexSkill = convertClaudeCommandToCodexSkill;\nexports.getCodexSkillAdapterHeader = getCodexSkillAdapterHeader;\nconst base_js_1 = require(\"../base.js\");\nconst tool_maps_js_1 = require(\"./tool-maps.js\");\nconst content_js_1 = require(\"./content.js\");\n/** Color name to hex mapping for opencode compatibility */\nexports.colorNameToHex = {\n    cyan: '#00FFFF',\n    red: '#FF0000',\n    green: '#00FF00',\n    blue: '#0000FF',\n    yellow: '#FFFF00',\n    magenta: '#FF00FF',\n    orange: '#FFA500',\n    purple: '#800080',\n    pink: '#FFC0CB',\n    white: '#FFFFFF',\n    black: '#000000',\n    gray: '#808080',\n    grey: '#808080',\n};\n/** Collapse whitespace to single line */\nfunction toSingleLine(value) {\n    return value.replace(/\\s+/g, ' ').trim();\n}\n/** Quote a value for YAML using JSON.stringify */\nfunction yamlQuote(value) {\n    return JSON.stringify(value);\n}\n/** Extract a single-line field value from YAML frontmatter text */\nfunction extractFrontmatterField(frontmatter, fieldName) {\n    const regex = new RegExp(`^${fieldName}:\\\\s*(.+)$`, 'm');\n    const match = frontmatter.match(regex);\n    if (!match)\n        return null;\n    return match[1].trim().replace(/^['\"]|['\"]$/g, '');\n}\n/**\n * Convert Claude Code frontmatter to OpenCode format.\n * - Converts 'allowed-tools:' array to 'tools:' object with tool: true entries\n * - Converts color names to hex\n * - Removes name: field (opencode uses filename)\n * - Replaces tool name references in body content\n * - Replaces /maxsim: with /maxsim- (flat command structure)\n * - Replaces ~/.claude with ~/.config/opencode\n * - Replaces subagent_type=\"general-purpose\" with \"general\"\n *\n * Ported from install.js line ~566\n */\nfunction convertClaudeToOpencodeFrontmatter(content) {\n    // Replace tool name references in content (applies to all files)\n    let convertedContent = content;\n    convertedContent = convertedContent.replace(/\\bAskUserQuestion\\b/g, 'question');\n    convertedContent = convertedContent.replace(/\\bSlashCommand\\b/g, 'skill');\n    convertedContent = convertedContent.replace(/\\bTodoWrite\\b/g, 'todowrite');\n    convertedContent = convertedContent.replace(/\\/maxsim:/g, '/maxsim-');\n    convertedContent = convertedContent.replace(/~\\/\\.claude\\b/g, '~/.config/opencode');\n    convertedContent = convertedContent.replace(/subagent_type=\"general-purpose\"/g, 'subagent_type=\"general\"');\n    if (!convertedContent.startsWith('---')) {\n        return convertedContent;\n    }\n    const endIndex = convertedContent.indexOf('---', 3);\n    if (endIndex === -1) {\n        return convertedContent;\n    }\n    const frontmatter = convertedContent.substring(3, endIndex).trim();\n    const body = convertedContent.substring(endIndex + 3);\n    const lines = frontmatter.split('\\n');\n    const newLines = [];\n    let inAllowedTools = false;\n    const allowedTools = [];\n    for (const line of lines) {\n        const trimmed = line.trim();\n        if (trimmed.startsWith('allowed-tools:')) {\n            inAllowedTools = true;\n            continue;\n        }\n        if (trimmed.startsWith('tools:')) {\n            const toolsValue = trimmed.substring(6).trim();\n            if (toolsValue) {\n                const tools = toolsValue.split(',').map((t) => t.trim()).filter((t) => t);\n                allowedTools.push(...tools);\n            }\n            continue;\n        }\n        if (trimmed.startsWith('name:')) {\n            continue;\n        }\n        if (trimmed.startsWith('color:')) {\n            const colorValue = trimmed.substring(6).trim().toLowerCase();\n            const hexColor = exports.colorNameToHex[colorValue];\n            if (hexColor) {\n                newLines.push(`color: \"${hexColor}\"`);\n            }\n            else if (colorValue.startsWith('#')) {\n                if (/^#[0-9a-f]{3}$|^#[0-9a-f]{6}$/i.test(colorValue)) {\n                    newLines.push(line);\n                }\n            }\n            continue;\n        }\n        if (inAllowedTools) {\n            if (trimmed.startsWith('- ')) {\n                allowedTools.push(trimmed.substring(2).trim());\n                continue;\n            }\n            else if (trimmed && !trimmed.startsWith('-')) {\n                inAllowedTools = false;\n            }\n        }\n        if (!inAllowedTools) {\n            newLines.push(line);\n        }\n    }\n    if (allowedTools.length > 0) {\n        newLines.push('tools:');\n        for (const tool of allowedTools) {\n            newLines.push(`  ${(0, tool_maps_js_1.convertToolName)(tool)}: true`);\n        }\n    }\n    const newFrontmatter = newLines.join('\\n').trim();\n    return `---\\n${newFrontmatter}\\n---${body}`;\n}\n/**\n * Convert Claude Code markdown command to Gemini TOML format.\n * Ported from install.js line ~677\n */\nfunction convertClaudeToGeminiToml(content) {\n    if (!content.startsWith('---')) {\n        return `prompt = ${JSON.stringify(content)}\\n`;\n    }\n    const endIndex = content.indexOf('---', 3);\n    if (endIndex === -1) {\n        return `prompt = ${JSON.stringify(content)}\\n`;\n    }\n    const frontmatter = content.substring(3, endIndex).trim();\n    const body = content.substring(endIndex + 3).trim();\n    let description = '';\n    const lines = frontmatter.split('\\n');\n    for (const line of lines) {\n        const trimmed = line.trim();\n        if (trimmed.startsWith('description:')) {\n            description = trimmed.substring(12).trim();\n            break;\n        }\n    }\n    let toml = '';\n    if (description) {\n        toml += `description = ${JSON.stringify(description)}\\n`;\n    }\n    toml += `prompt = ${JSON.stringify(body)}\\n`;\n    return toml;\n}\n/**\n * Convert Claude command to Codex skill format with adapter header.\n * Ported from install.js line ~452\n */\nfunction convertClaudeCommandToCodexSkill(content, skillName) {\n    const converted = (0, content_js_1.convertClaudeToCodexMarkdown)(content);\n    const { frontmatter, body } = (0, base_js_1.extractFrontmatterAndBody)(converted);\n    let description = `Run MAXSIM workflow ${skillName}.`;\n    if (frontmatter) {\n        const maybeDescription = extractFrontmatterField(frontmatter, 'description');\n        if (maybeDescription) {\n            description = maybeDescription;\n        }\n    }\n    description = toSingleLine(description);\n    const shortDescription = description.length > 180 ? `${description.slice(0, 177)}...` : description;\n    const adapter = getCodexSkillAdapterHeader(skillName);\n    return `---\\nname: ${yamlQuote(skillName)}\\ndescription: ${yamlQuote(description)}\\nmetadata:\\n  short-description: ${yamlQuote(shortDescription)}\\n---\\n\\n${adapter}\\n\\n${body.trimStart()}`;\n}\n/**\n * Generate the Codex skill adapter header block.\n * Ported from install.js line ~437\n */\nfunction getCodexSkillAdapterHeader(skillName) {\n    const invocation = `$${skillName}`;\n    return `<codex_skill_adapter>\nCodex skills-first mode:\n- This skill is invoked by mentioning \\`${invocation}\\`.\n- Treat all user text after \\`${invocation}\\` as \\`{{MAXSIM_ARGS}}\\`.\n- If no arguments are present, treat \\`{{MAXSIM_ARGS}}\\` as empty.\n\nLegacy orchestration compatibility:\n- Any \\`Task(...)\\` pattern in referenced workflow docs is legacy syntax.\n- Implement equivalent behavior with Codex collaboration tools: \\`spawn_agent\\`, \\`wait\\`, \\`send_input\\`, and \\`close_agent\\`.\n- Treat legacy \\`subagent_type\\` names as role hints in the spawned message.\n</codex_skill_adapter>`;\n}\n//# sourceMappingURL=frontmatter.js.map","\"use strict\";\n/**\n * @maxsim/adapters — OpenCode adapter\n *\n * Ports the OpenCode-specific logic from bin/install.js:\n *   - getOpencodeGlobalDir()           (lines 79-97)\n *   - getGlobalDir('opencode', ...)    (lines 104-111)\n *   - getDirName('opencode')           (line 46)\n *   - getConfigDirFromHome('opencode', isGlobal) (lines 58-68)\n *   - convertClaudeToOpencodeFrontmatter + path replacement\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.opencodeAdapter = void 0;\nconst path = __importStar(require(\"node:path\"));\nconst os = __importStar(require(\"node:os\"));\nconst base_js_1 = require(\"./base.js\");\nconst frontmatter_js_1 = require(\"./transforms/frontmatter.js\");\nconst content_js_1 = require(\"./transforms/content.js\");\n/**\n * Get the global config directory for OpenCode.\n * OpenCode follows XDG Base Directory spec and uses ~/.config/opencode/.\n * Priority: OPENCODE_CONFIG_DIR > dirname(OPENCODE_CONFIG) > XDG_CONFIG_HOME/opencode > ~/.config/opencode\n */\nfunction getOpencodeGlobalDir() {\n    if (process.env.OPENCODE_CONFIG_DIR) {\n        return (0, base_js_1.expandTilde)(process.env.OPENCODE_CONFIG_DIR);\n    }\n    if (process.env.OPENCODE_CONFIG) {\n        return path.dirname((0, base_js_1.expandTilde)(process.env.OPENCODE_CONFIG));\n    }\n    if (process.env.XDG_CONFIG_HOME) {\n        return path.join((0, base_js_1.expandTilde)(process.env.XDG_CONFIG_HOME), 'opencode');\n    }\n    return path.join(os.homedir(), '.config', 'opencode');\n}\n/**\n * Get the global config directory for OpenCode.\n * Priority: explicitDir > env vars (via getOpencodeGlobalDir)\n */\nfunction getGlobalDir(explicitDir) {\n    if (explicitDir) {\n        return (0, base_js_1.expandTilde)(explicitDir);\n    }\n    return getOpencodeGlobalDir();\n}\n/**\n * Get the config directory path relative to home for hook templating.\n */\nfunction getConfigDirFromHome(isGlobal) {\n    if (!isGlobal) {\n        return \"'.opencode'\";\n    }\n    return \"'.config', 'opencode'\";\n}\n/**\n * Transform markdown content for OpenCode installation.\n * Applies frontmatter conversion and path replacement.\n */\nfunction transformContent(content, pathPrefix) {\n    let result = (0, content_js_1.replacePathReferences)(content, pathPrefix, '.opencode');\n    // Also replace ~/.opencode/ references\n    result = result.replace(/~\\/\\.opencode\\//g, pathPrefix);\n    result = (0, frontmatter_js_1.convertClaudeToOpencodeFrontmatter)(result);\n    return result;\n}\n/**\n * OpenCode adapter configuration.\n * OpenCode uses flat command structure (command/maxsim-*.md).\n */\nexports.opencodeAdapter = {\n    runtime: 'opencode',\n    dirName: '.opencode',\n    getGlobalDir,\n    getConfigDirFromHome,\n    transformContent,\n    commandStructure: 'flat',\n};\n//# sourceMappingURL=opencode.js.map","\"use strict\";\n/**\n * @maxsim/adapters — Gemini adapter\n *\n * Ports the Gemini-specific logic from bin/install.js:\n *   - getGlobalDir('gemini', ...)         (lines 113-122)\n *   - getDirName('gemini')                (line 47)\n *   - getConfigDirFromHome('gemini', isGlobal) (line 69)\n *   - convertClaudeToGeminiToml + convertClaudeToGeminiAgent + stripSubTags\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.stripSubTags = exports.convertClaudeToGeminiAgent = exports.convertClaudeToGeminiToml = exports.geminiAdapter = void 0;\nconst path = __importStar(require(\"node:path\"));\nconst os = __importStar(require(\"node:os\"));\nconst base_js_1 = require(\"./base.js\");\nconst frontmatter_js_1 = require(\"./transforms/frontmatter.js\");\nObject.defineProperty(exports, \"convertClaudeToGeminiToml\", { enumerable: true, get: function () { return frontmatter_js_1.convertClaudeToGeminiToml; } });\nconst content_js_1 = require(\"./transforms/content.js\");\nObject.defineProperty(exports, \"convertClaudeToGeminiAgent\", { enumerable: true, get: function () { return content_js_1.convertClaudeToGeminiAgent; } });\nObject.defineProperty(exports, \"stripSubTags\", { enumerable: true, get: function () { return content_js_1.stripSubTags; } });\n/**\n * Get the global config directory for Gemini.\n * Priority: explicitDir > GEMINI_CONFIG_DIR env > ~/.gemini\n */\nfunction getGlobalDir(explicitDir) {\n    if (explicitDir) {\n        return (0, base_js_1.expandTilde)(explicitDir);\n    }\n    if (process.env.GEMINI_CONFIG_DIR) {\n        return (0, base_js_1.expandTilde)(process.env.GEMINI_CONFIG_DIR);\n    }\n    return path.join(os.homedir(), '.gemini');\n}\n/**\n * Get the config directory path relative to home for hook templating.\n */\nfunction getConfigDirFromHome(_isGlobal) {\n    return \"'.gemini'\";\n}\n/**\n * Transform markdown content for Gemini installation.\n * Applies TOML conversion for commands, agent conversion for agents,\n * stripSubTags, and path replacement.\n */\nfunction transformContent(content, pathPrefix) {\n    let result = (0, content_js_1.replacePathReferences)(content, pathPrefix, '.gemini');\n    result = (0, content_js_1.stripSubTags)(result);\n    result = (0, frontmatter_js_1.convertClaudeToGeminiToml)(result);\n    return result;\n}\n/**\n * Gemini adapter configuration.\n * Gemini uses nested command structure (commands/maxsim/*.toml).\n */\nexports.geminiAdapter = {\n    runtime: 'gemini',\n    dirName: '.gemini',\n    getGlobalDir,\n    getConfigDirFromHome,\n    transformContent,\n    commandStructure: 'nested',\n};\n//# sourceMappingURL=gemini.js.map","\"use strict\";\n/**\n * @maxsim/adapters — Codex adapter\n *\n * Ports the Codex-specific logic from bin/install.js:\n *   - getGlobalDir('codex', ...)         (lines 124-133)\n *   - getDirName('codex')                (line 48)\n *   - getConfigDirFromHome('codex', isGlobal) (line 70)\n *   - convertClaudeCommandToCodexSkill + convertClaudeToCodexMarkdown\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || (function () {\n    var ownKeys = function(o) {\n        ownKeys = Object.getOwnPropertyNames || function (o) {\n            var ar = [];\n            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\n            return ar;\n        };\n        return ownKeys(o);\n    };\n    return function (mod) {\n        if (mod && mod.__esModule) return mod;\n        var result = {};\n        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\n        __setModuleDefault(result, mod);\n        return result;\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.convertClaudeToCodexMarkdown = exports.convertClaudeCommandToCodexSkill = exports.codexAdapter = void 0;\nconst path = __importStar(require(\"node:path\"));\nconst os = __importStar(require(\"node:os\"));\nconst base_js_1 = require(\"./base.js\");\nconst frontmatter_js_1 = require(\"./transforms/frontmatter.js\");\nObject.defineProperty(exports, \"convertClaudeCommandToCodexSkill\", { enumerable: true, get: function () { return frontmatter_js_1.convertClaudeCommandToCodexSkill; } });\nconst content_js_1 = require(\"./transforms/content.js\");\nObject.defineProperty(exports, \"convertClaudeToCodexMarkdown\", { enumerable: true, get: function () { return content_js_1.convertClaudeToCodexMarkdown; } });\n/**\n * Get the global config directory for Codex.\n * Priority: explicitDir > CODEX_HOME env > ~/.codex\n */\nfunction getGlobalDir(explicitDir) {\n    if (explicitDir) {\n        return (0, base_js_1.expandTilde)(explicitDir);\n    }\n    if (process.env.CODEX_HOME) {\n        return (0, base_js_1.expandTilde)(process.env.CODEX_HOME);\n    }\n    return path.join(os.homedir(), '.codex');\n}\n/**\n * Get the config directory path relative to home for hook templating.\n */\nfunction getConfigDirFromHome(_isGlobal) {\n    return \"'.codex'\";\n}\n/**\n * Transform markdown content for Codex installation.\n * Applies Codex markdown conversion and path replacement.\n */\nfunction transformContent(content, pathPrefix) {\n    let result = (0, content_js_1.replacePathReferences)(content, pathPrefix, '.codex');\n    result = result.replace(/~\\/\\.codex\\//g, pathPrefix);\n    result = (0, frontmatter_js_1.convertClaudeCommandToCodexSkill)(result);\n    return result;\n}\n/**\n * Codex adapter configuration.\n * Codex uses skill-based command structure (skills/maxsim-star/SKILL.md).\n */\nexports.codexAdapter = {\n    runtime: 'codex',\n    dirName: '.codex',\n    getGlobalDir,\n    getConfigDirFromHome,\n    transformContent,\n    commandStructure: 'skills',\n};\n//# sourceMappingURL=codex.js.map","\"use strict\";\n/**\n * @maxsim/adapters — Runtime adapter registry\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.replacePathReferences = exports.convertClaudeToGeminiAgent = exports.stripSubTags = exports.convertClaudeToCodexMarkdown = exports.convertSlashCommandsToCodexSkillMentions = exports.getCodexSkillAdapterHeader = exports.convertClaudeCommandToCodexSkill = exports.convertClaudeToGeminiToml = exports.convertClaudeToOpencodeFrontmatter = exports.extractFrontmatterField = exports.yamlQuote = exports.toSingleLine = exports.colorNameToHex = exports.convertGeminiToolName = exports.convertToolName = exports.writeSettings = exports.readSettings = exports.buildHookCommand = exports.processAttribution = exports.extractFrontmatterAndBody = exports.expandTilde = exports.codexAdapter = exports.geminiAdapter = exports.opencodeAdapter = exports.installClaude = exports.claudeAdapter = void 0;\nexports.getAllAdapters = getAllAdapters;\nconst claude_js_1 = require(\"./claude.js\");\nconst opencode_js_1 = require(\"./opencode.js\");\nconst gemini_js_1 = require(\"./gemini.js\");\nconst codex_js_1 = require(\"./codex.js\");\n// Re-export adapters\nvar claude_js_2 = require(\"./claude.js\");\nObject.defineProperty(exports, \"claudeAdapter\", { enumerable: true, get: function () { return claude_js_2.claudeAdapter; } });\nvar claude_js_3 = require(\"./claude.js\");\nObject.defineProperty(exports, \"installClaude\", { enumerable: true, get: function () { return claude_js_3.installClaude; } });\nvar opencode_js_2 = require(\"./opencode.js\");\nObject.defineProperty(exports, \"opencodeAdapter\", { enumerable: true, get: function () { return opencode_js_2.opencodeAdapter; } });\nvar gemini_js_2 = require(\"./gemini.js\");\nObject.defineProperty(exports, \"geminiAdapter\", { enumerable: true, get: function () { return gemini_js_2.geminiAdapter; } });\nvar codex_js_2 = require(\"./codex.js\");\nObject.defineProperty(exports, \"codexAdapter\", { enumerable: true, get: function () { return codex_js_2.codexAdapter; } });\n// Re-export base utilities\nvar base_js_1 = require(\"./base.js\");\nObject.defineProperty(exports, \"expandTilde\", { enumerable: true, get: function () { return base_js_1.expandTilde; } });\nObject.defineProperty(exports, \"extractFrontmatterAndBody\", { enumerable: true, get: function () { return base_js_1.extractFrontmatterAndBody; } });\nObject.defineProperty(exports, \"processAttribution\", { enumerable: true, get: function () { return base_js_1.processAttribution; } });\nObject.defineProperty(exports, \"buildHookCommand\", { enumerable: true, get: function () { return base_js_1.buildHookCommand; } });\nObject.defineProperty(exports, \"readSettings\", { enumerable: true, get: function () { return base_js_1.readSettings; } });\nObject.defineProperty(exports, \"writeSettings\", { enumerable: true, get: function () { return base_js_1.writeSettings; } });\n// Re-export transform functions\nvar tool_maps_js_1 = require(\"./transforms/tool-maps.js\");\nObject.defineProperty(exports, \"convertToolName\", { enumerable: true, get: function () { return tool_maps_js_1.convertToolName; } });\nObject.defineProperty(exports, \"convertGeminiToolName\", { enumerable: true, get: function () { return tool_maps_js_1.convertGeminiToolName; } });\nvar frontmatter_js_1 = require(\"./transforms/frontmatter.js\");\nObject.defineProperty(exports, \"colorNameToHex\", { enumerable: true, get: function () { return frontmatter_js_1.colorNameToHex; } });\nObject.defineProperty(exports, \"toSingleLine\", { enumerable: true, get: function () { return frontmatter_js_1.toSingleLine; } });\nObject.defineProperty(exports, \"yamlQuote\", { enumerable: true, get: function () { return frontmatter_js_1.yamlQuote; } });\nObject.defineProperty(exports, \"extractFrontmatterField\", { enumerable: true, get: function () { return frontmatter_js_1.extractFrontmatterField; } });\nObject.defineProperty(exports, \"convertClaudeToOpencodeFrontmatter\", { enumerable: true, get: function () { return frontmatter_js_1.convertClaudeToOpencodeFrontmatter; } });\nObject.defineProperty(exports, \"convertClaudeToGeminiToml\", { enumerable: true, get: function () { return frontmatter_js_1.convertClaudeToGeminiToml; } });\nObject.defineProperty(exports, \"convertClaudeCommandToCodexSkill\", { enumerable: true, get: function () { return frontmatter_js_1.convertClaudeCommandToCodexSkill; } });\nObject.defineProperty(exports, \"getCodexSkillAdapterHeader\", { enumerable: true, get: function () { return frontmatter_js_1.getCodexSkillAdapterHeader; } });\nvar content_js_1 = require(\"./transforms/content.js\");\nObject.defineProperty(exports, \"convertSlashCommandsToCodexSkillMentions\", { enumerable: true, get: function () { return content_js_1.convertSlashCommandsToCodexSkillMentions; } });\nObject.defineProperty(exports, \"convertClaudeToCodexMarkdown\", { enumerable: true, get: function () { return content_js_1.convertClaudeToCodexMarkdown; } });\nObject.defineProperty(exports, \"stripSubTags\", { enumerable: true, get: function () { return content_js_1.stripSubTags; } });\nObject.defineProperty(exports, \"convertClaudeToGeminiAgent\", { enumerable: true, get: function () { return content_js_1.convertClaudeToGeminiAgent; } });\nObject.defineProperty(exports, \"replacePathReferences\", { enumerable: true, get: function () { return content_js_1.replacePathReferences; } });\n/**\n * Get all registered adapters.\n */\nfunction getAllAdapters() {\n    return [claude_js_1.claudeAdapter, opencode_js_1.opencodeAdapter, gemini_js_1.geminiAdapter, codex_js_1.codexAdapter];\n}\n//# sourceMappingURL=index.js.map","","import * as fs from 'node:fs';\r\nimport * as path from 'node:path';\r\nimport * as os from 'node:os';\r\nimport * as readline from 'node:readline';\r\nimport * as crypto from 'node:crypto';\r\n\r\nimport type { RuntimeName, AdapterConfig } from '@maxsim/adapters';\r\nimport {\r\n  claudeAdapter,\r\n  opencodeAdapter,\r\n  geminiAdapter,\r\n  codexAdapter,\r\n  expandTilde,\r\n  processAttribution,\r\n  buildHookCommand,\r\n  readSettings,\r\n  writeSettings,\r\n  convertClaudeToOpencodeFrontmatter,\r\n  convertClaudeToGeminiToml,\r\n  convertClaudeCommandToCodexSkill,\r\n  convertClaudeToCodexMarkdown,\r\n  stripSubTags,\r\n  convertClaudeToGeminiAgent,\r\n} from '@maxsim/adapters';\r\n\r\n// Colors\r\nconst cyan = '\\x1b[36m';\r\nconst green = '\\x1b[32m';\r\nconst yellow = '\\x1b[33m';\r\nconst dim = '\\x1b[2m';\r\nconst reset = '\\x1b[0m';\r\n\r\n// Get version from package.json\r\n// eslint-disable-next-line @typescript-eslint/no-require-imports\r\nconst pkg = require('../package.json') as { version: string };\r\n\r\n// Resolve template asset root — bundled into dist/assets/templates at publish time\r\nconst templatesRoot = path.resolve(__dirname, 'assets', 'templates');\r\n\r\n// Parse args\r\nconst args = process.argv.slice(2);\r\nconst hasGlobal = args.includes('--global') || args.includes('-g');\r\nconst hasLocal = args.includes('--local') || args.includes('-l');\r\nconst hasOpencode = args.includes('--opencode');\r\nconst hasClaude = args.includes('--claude');\r\nconst hasGemini = args.includes('--gemini');\r\nconst hasCodex = args.includes('--codex');\r\nconst hasBoth = args.includes('--both'); // Legacy flag, keeps working\r\nconst hasAll = args.includes('--all');\r\nconst hasUninstall = args.includes('--uninstall') || args.includes('-u');\r\n\r\n// Runtime selection - can be set by flags or interactive prompt\r\nlet selectedRuntimes: RuntimeName[] = [];\r\nif (hasAll) {\r\n  selectedRuntimes = ['claude', 'opencode', 'gemini', 'codex'];\r\n} else if (hasBoth) {\r\n  selectedRuntimes = ['claude', 'opencode'];\r\n} else {\r\n  if (hasOpencode) selectedRuntimes.push('opencode');\r\n  if (hasClaude) selectedRuntimes.push('claude');\r\n  if (hasGemini) selectedRuntimes.push('gemini');\r\n  if (hasCodex) selectedRuntimes.push('codex');\r\n}\r\n\r\n/**\r\n * Adapter registry keyed by runtime name\r\n */\r\nconst adapterMap: Record<RuntimeName, AdapterConfig> = {\r\n  claude: claudeAdapter,\r\n  opencode: opencodeAdapter,\r\n  gemini: geminiAdapter,\r\n  codex: codexAdapter,\r\n};\r\n\r\n/**\r\n * Get adapter for a runtime\r\n */\r\nfunction getAdapter(runtime: RuntimeName): AdapterConfig {\r\n  return adapterMap[runtime];\r\n}\r\n\r\n/**\r\n * Get the global config directory for a runtime, using adapter\r\n */\r\nfunction getGlobalDir(runtime: RuntimeName, explicitDir: string | null = null): string {\r\n  return getAdapter(runtime).getGlobalDir(explicitDir);\r\n}\r\n\r\n/**\r\n * Get the config directory path relative to home for hook templating\r\n */\r\nfunction getConfigDirFromHome(runtime: RuntimeName, isGlobal: boolean): string {\r\n  return getAdapter(runtime).getConfigDirFromHome(isGlobal);\r\n}\r\n\r\n/**\r\n * Get the local directory name for a runtime\r\n */\r\nfunction getDirName(runtime: RuntimeName): string {\r\n  return getAdapter(runtime).dirName;\r\n}\r\n\r\n/**\r\n * Get the global config directory for OpenCode (for JSONC permissions)\r\n * OpenCode follows XDG Base Directory spec\r\n */\r\nfunction getOpencodeGlobalDir(): string {\r\n  return opencodeAdapter.getGlobalDir();\r\n}\r\n\r\nconst banner =\r\n  '\\n' +\r\n  cyan +\r\n  '  \\u2588\\u2588\\u2557  \\u2588\\u2588\\u2557 \\u2588\\u2588\\u2588\\u2588\\u2588\\u2557 \\u2588\\u2588\\u2557  \\u2588\\u2588\\u2557\\u2588\\u2588\\u2588\\u2588\\u2588\\u2588\\u2588\\u2557\\u2588\\u2588\\u2557\\u2588\\u2588\\u2557  \\u2588\\u2588\\u2557\\n' +\r\n  '  \\u2588\\u2588\\u2588\\u2557\\u2588\\u2588\\u2588\\u2551\\u2588\\u2588\\u2554\\u2550\\u2550\\u2588\\u2588\\u2557\\u255a\\u2588\\u2588\\u2557\\u2588\\u2588\\u2554\\u255d\\u2588\\u2588\\u2554\\u2550\\u2550\\u2550\\u2550\\u255d\\u2588\\u2588\\u2551\\u2588\\u2588\\u2588\\u2557\\u2588\\u2588\\u2588\\u2551\\n' +\r\n  '  \\u2588\\u2588\\u2554\\u2588\\u2588\\u2588\\u2588\\u2554\\u2588\\u2588\\u2551\\u2588\\u2588\\u2588\\u2588\\u2588\\u2588\\u2588\\u2551 \\u255a\\u2588\\u2588\\u2588\\u2554\\u255d \\u2588\\u2588\\u2588\\u2588\\u2588\\u2588\\u2588\\u2557\\u2588\\u2588\\u2551\\u2588\\u2588\\u2554\\u2588\\u2588\\u2588\\u2588\\u2554\\u2588\\u2588\\u2551\\n' +\r\n  '  \\u2588\\u2588\\u2551\\u255a\\u2588\\u2588\\u2554\\u255d\\u2588\\u2588\\u2551\\u2588\\u2588\\u2554\\u2550\\u2550\\u2588\\u2588\\u2551 \\u2588\\u2588\\u2554\\u2588\\u2588\\u2557 \\u255a\\u2550\\u2550\\u2550\\u2550\\u2588\\u2588\\u2551\\u2588\\u2588\\u2551\\u2588\\u2588\\u2551\\u255a\\u2588\\u2588\\u2554\\u255d\\u2588\\u2588\\u2551\\n' +\r\n  '  \\u2588\\u2588\\u2551 \\u255a\\u2550\\u255d \\u2588\\u2588\\u2551\\u2588\\u2588\\u2551  \\u2588\\u2588\\u2551\\u2588\\u2588\\u2554\\u255d \\u2588\\u2588\\u2557\\u2588\\u2588\\u2588\\u2588\\u2588\\u2588\\u2588\\u2551\\u2588\\u2588\\u2551\\u2588\\u2588\\u2551 \\u255a\\u2550\\u255d \\u2588\\u2588\\u2551\\n' +\r\n  '  \\u255a\\u2550\\u255d     \\u255a\\u2550\\u255d\\u255a\\u2550\\u255d  \\u255a\\u2550\\u255d\\u255a\\u2550\\u255d  \\u255a\\u2550\\u255d\\u255a\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u255d\\u255a\\u2550\\u255d\\u255a\\u2550\\u255d     \\u255a\\u2550\\u255d' +\r\n  reset +\r\n  '\\n' +\r\n  '\\n' +\r\n  '  MAXSIM ' +\r\n  dim +\r\n  'v' +\r\n  pkg.version +\r\n  reset +\r\n  '\\n' +\r\n  '  A meta-prompting, context engineering and spec-driven\\n' +\r\n  '  development system for Claude Code, OpenCode, Gemini, and Codex.\\n';\r\n\r\n// Parse --config-dir argument\r\nfunction parseConfigDirArg(): string | null {\r\n  const configDirIndex = args.findIndex(\r\n    (arg) => arg === '--config-dir' || arg === '-c',\r\n  );\r\n  if (configDirIndex !== -1) {\r\n    const nextArg = args[configDirIndex + 1];\r\n    if (!nextArg || nextArg.startsWith('-')) {\r\n      console.error(`  ${yellow}--config-dir requires a path argument${reset}`);\r\n      process.exit(1);\r\n    }\r\n    return nextArg;\r\n  }\r\n  const configDirArg = args.find(\r\n    (arg) => arg.startsWith('--config-dir=') || arg.startsWith('-c='),\r\n  );\r\n  if (configDirArg) {\r\n    const value = configDirArg.split('=')[1];\r\n    if (!value) {\r\n      console.error(\r\n        `  ${yellow}--config-dir requires a non-empty path${reset}`,\r\n      );\r\n      process.exit(1);\r\n    }\r\n    return value;\r\n  }\r\n  return null;\r\n}\r\nconst explicitConfigDir = parseConfigDirArg();\r\nconst hasHelp = args.includes('--help') || args.includes('-h');\r\nconst forceStatusline = args.includes('--force-statusline');\r\n\r\nconsole.log(banner);\r\n\r\n// Show help if requested\r\nif (hasHelp) {\r\n  console.log(\r\n    `  ${yellow}Usage:${reset} npx maxsimcli [options]\\n\\n  ${yellow}Options:${reset}\\n    ${cyan}-g, --global${reset}              Install globally (to config directory)\\n    ${cyan}-l, --local${reset}               Install locally (to current directory)\\n    ${cyan}--claude${reset}                  Install for Claude Code only\\n    ${cyan}--opencode${reset}                Install for OpenCode only\\n    ${cyan}--gemini${reset}                  Install for Gemini only\\n    ${cyan}--codex${reset}                   Install for Codex only\\n    ${cyan}--all${reset}                     Install for all runtimes\\n    ${cyan}-u, --uninstall${reset}           Uninstall MAXSIM (remove all MAXSIM files)\\n    ${cyan}-c, --config-dir <path>${reset}   Specify custom config directory\\n    ${cyan}-h, --help${reset}                Show this help message\\n    ${cyan}--force-statusline${reset}        Replace existing statusline config\\n\\n  ${yellow}Examples:${reset}\\n    ${dim}# Interactive install (prompts for runtime and location)${reset}\\n    npx maxsimcli\\n\\n    ${dim}# Install for Claude Code globally${reset}\\n    npx maxsimcli --claude --global\\n\\n    ${dim}# Install for Gemini globally${reset}\\n    npx maxsimcli --gemini --global\\n\\n    ${dim}# Install for Codex globally${reset}\\n    npx maxsimcli --codex --global\\n\\n    ${dim}# Install for all runtimes globally${reset}\\n    npx maxsimcli --all --global\\n\\n    ${dim}# Install to custom config directory${reset}\\n    npx maxsimcli --codex --global --config-dir ~/.codex-work\\n\\n    ${dim}# Install to current project only${reset}\\n    npx maxsimcli --claude --local\\n\\n    ${dim}# Uninstall MAXSIM from Codex globally${reset}\\n    npx maxsimcli --codex --global --uninstall\\n\\n  ${yellow}Notes:${reset}\\n    The --config-dir option is useful when you have multiple configurations.\\n    It takes priority over CLAUDE_CONFIG_DIR / GEMINI_CONFIG_DIR / CODEX_HOME environment variables.\\n`,\r\n  );\r\n  process.exit(0);\r\n}\r\n\r\n// Cache for attribution settings (populated once per runtime during install)\r\nconst attributionCache = new Map<RuntimeName, null | undefined | string>();\r\n\r\n/**\r\n * Get commit attribution setting for a runtime\r\n * @returns null = remove, undefined = keep default, string = custom\r\n */\r\nfunction getCommitAttribution(runtime: RuntimeName): null | undefined | string {\r\n  if (attributionCache.has(runtime)) {\r\n    return attributionCache.get(runtime);\r\n  }\r\n\r\n  let result: null | undefined | string;\r\n\r\n  if (runtime === 'opencode') {\r\n    const config = readSettings(\r\n      path.join(getGlobalDir('opencode', null), 'opencode.json'),\r\n    ) as Record<string, unknown>;\r\n    result =\r\n      (config as { disable_ai_attribution?: boolean }).disable_ai_attribution === true\r\n        ? null\r\n        : undefined;\r\n  } else if (runtime === 'gemini') {\r\n    const settings = readSettings(\r\n      path.join(getGlobalDir('gemini', explicitConfigDir), 'settings.json'),\r\n    ) as Record<string, unknown>;\r\n    const attr = settings.attribution as { commit?: string } | undefined;\r\n    if (!attr || attr.commit === undefined) {\r\n      result = undefined;\r\n    } else if (attr.commit === '') {\r\n      result = null;\r\n    } else {\r\n      result = attr.commit;\r\n    }\r\n  } else if (runtime === 'claude') {\r\n    const settings = readSettings(\r\n      path.join(getGlobalDir('claude', explicitConfigDir), 'settings.json'),\r\n    ) as Record<string, unknown>;\r\n    const attr = settings.attribution as { commit?: string } | undefined;\r\n    if (!attr || attr.commit === undefined) {\r\n      result = undefined;\r\n    } else if (attr.commit === '') {\r\n      result = null;\r\n    } else {\r\n      result = attr.commit;\r\n    }\r\n  } else {\r\n    result = undefined;\r\n  }\r\n\r\n  attributionCache.set(runtime, result);\r\n  return result;\r\n}\r\n\r\n/**\r\n * Copy commands to a flat structure for OpenCode\r\n * OpenCode expects: command/maxsim-help.md (invoked as /maxsim-help)\r\n * Source structure: commands/maxsim/help.md\r\n */\r\nfunction copyFlattenedCommands(\r\n  srcDir: string,\r\n  destDir: string,\r\n  prefix: string,\r\n  pathPrefix: string,\r\n  runtime: RuntimeName,\r\n): void {\r\n  if (!fs.existsSync(srcDir)) {\r\n    return;\r\n  }\r\n\r\n  if (fs.existsSync(destDir)) {\r\n    for (const file of fs.readdirSync(destDir)) {\r\n      if (file.startsWith(`${prefix}-`) && file.endsWith('.md')) {\r\n        fs.unlinkSync(path.join(destDir, file));\r\n      }\r\n    }\r\n  } else {\r\n    fs.mkdirSync(destDir, { recursive: true });\r\n  }\r\n\r\n  const entries = fs.readdirSync(srcDir, { withFileTypes: true });\r\n\r\n  for (const entry of entries) {\r\n    const srcPath = path.join(srcDir, entry.name);\r\n\r\n    if (entry.isDirectory()) {\r\n      copyFlattenedCommands(\r\n        srcPath,\r\n        destDir,\r\n        `${prefix}-${entry.name}`,\r\n        pathPrefix,\r\n        runtime,\r\n      );\r\n    } else if (entry.name.endsWith('.md')) {\r\n      const baseName = entry.name.replace('.md', '');\r\n      const destName = `${prefix}-${baseName}.md`;\r\n      const destPath = path.join(destDir, destName);\r\n\r\n      let content = fs.readFileSync(srcPath, 'utf8');\r\n      const globalClaudeRegex = /~\\/\\.claude\\//g;\r\n      const localClaudeRegex = /\\.\\/\\.claude\\//g;\r\n      const opencodeDirRegex = /~\\/\\.opencode\\//g;\r\n      content = content.replace(globalClaudeRegex, pathPrefix);\r\n      content = content.replace(localClaudeRegex, `./${getDirName(runtime)}/`);\r\n      content = content.replace(opencodeDirRegex, pathPrefix);\r\n      content = processAttribution(content, getCommitAttribution(runtime));\r\n      content = convertClaudeToOpencodeFrontmatter(content);\r\n\r\n      fs.writeFileSync(destPath, content);\r\n    }\r\n  }\r\n}\r\n\r\nfunction listCodexSkillNames(\r\n  skillsDir: string,\r\n  prefix: string = 'maxsim-',\r\n): string[] {\r\n  if (!fs.existsSync(skillsDir)) return [];\r\n  const entries = fs.readdirSync(skillsDir, { withFileTypes: true });\r\n  return entries\r\n    .filter((entry) => entry.isDirectory() && entry.name.startsWith(prefix))\r\n    .filter((entry) =>\r\n      fs.existsSync(path.join(skillsDir, entry.name, 'SKILL.md')),\r\n    )\r\n    .map((entry) => entry.name)\r\n    .sort();\r\n}\r\n\r\nfunction copyCommandsAsCodexSkills(\r\n  srcDir: string,\r\n  skillsDir: string,\r\n  prefix: string,\r\n  pathPrefix: string,\r\n  runtime: RuntimeName,\r\n): void {\r\n  if (!fs.existsSync(srcDir)) {\r\n    return;\r\n  }\r\n\r\n  fs.mkdirSync(skillsDir, { recursive: true });\r\n\r\n  const existing = fs.readdirSync(skillsDir, { withFileTypes: true });\r\n  for (const entry of existing) {\r\n    if (entry.isDirectory() && entry.name.startsWith(`${prefix}-`)) {\r\n      fs.rmSync(path.join(skillsDir, entry.name), { recursive: true });\r\n    }\r\n  }\r\n\r\n  function recurse(currentSrcDir: string, currentPrefix: string): void {\r\n    const entries = fs.readdirSync(currentSrcDir, { withFileTypes: true });\r\n\r\n    for (const entry of entries) {\r\n      const srcPath = path.join(currentSrcDir, entry.name);\r\n      if (entry.isDirectory()) {\r\n        recurse(srcPath, `${currentPrefix}-${entry.name}`);\r\n        continue;\r\n      }\r\n\r\n      if (!entry.name.endsWith('.md')) {\r\n        continue;\r\n      }\r\n\r\n      const baseName = entry.name.replace('.md', '');\r\n      const skillName = `${currentPrefix}-${baseName}`;\r\n      const skillDir = path.join(skillsDir, skillName);\r\n      fs.mkdirSync(skillDir, { recursive: true });\r\n\r\n      let content = fs.readFileSync(srcPath, 'utf8');\r\n      const globalClaudeRegex = /~\\/\\.claude\\//g;\r\n      const localClaudeRegex = /\\.\\/\\.claude\\//g;\r\n      const codexDirRegex = /~\\/\\.codex\\//g;\r\n      content = content.replace(globalClaudeRegex, pathPrefix);\r\n      content = content.replace(localClaudeRegex, `./${getDirName(runtime)}/`);\r\n      content = content.replace(codexDirRegex, pathPrefix);\r\n      content = processAttribution(content, getCommitAttribution(runtime));\r\n      content = convertClaudeCommandToCodexSkill(content, skillName);\r\n\r\n      fs.writeFileSync(path.join(skillDir, 'SKILL.md'), content);\r\n    }\r\n  }\r\n\r\n  recurse(srcDir, prefix);\r\n}\r\n\r\n/**\r\n * Recursively copy directory, replacing paths in .md files\r\n * Deletes existing destDir first to remove orphaned files from previous versions\r\n */\r\nfunction copyWithPathReplacement(\r\n  srcDir: string,\r\n  destDir: string,\r\n  pathPrefix: string,\r\n  runtime: RuntimeName,\r\n  isCommand: boolean = false,\r\n): void {\r\n  const isOpencode = runtime === 'opencode';\r\n  const isCodex = runtime === 'codex';\r\n  const dirName = getDirName(runtime);\r\n\r\n  if (fs.existsSync(destDir)) {\r\n    fs.rmSync(destDir, { recursive: true });\r\n  }\r\n  fs.mkdirSync(destDir, { recursive: true });\r\n\r\n  const entries = fs.readdirSync(srcDir, { withFileTypes: true });\r\n\r\n  for (const entry of entries) {\r\n    const srcPath = path.join(srcDir, entry.name);\r\n    const destPath = path.join(destDir, entry.name);\r\n\r\n    if (entry.isDirectory()) {\r\n      copyWithPathReplacement(srcPath, destPath, pathPrefix, runtime, isCommand);\r\n    } else if (entry.name.endsWith('.md')) {\r\n      let content = fs.readFileSync(srcPath, 'utf8');\r\n      const globalClaudeRegex = /~\\/\\.claude\\//g;\r\n      const localClaudeRegex = /\\.\\/\\.claude\\//g;\r\n      content = content.replace(globalClaudeRegex, pathPrefix);\r\n      content = content.replace(localClaudeRegex, `./${dirName}/`);\r\n      content = processAttribution(content, getCommitAttribution(runtime));\r\n\r\n      if (isOpencode) {\r\n        content = convertClaudeToOpencodeFrontmatter(content);\r\n        fs.writeFileSync(destPath, content);\r\n      } else if (runtime === 'gemini') {\r\n        if (isCommand) {\r\n          content = stripSubTags(content);\r\n          const tomlContent = convertClaudeToGeminiToml(content);\r\n          const tomlPath = destPath.replace(/\\.md$/, '.toml');\r\n          fs.writeFileSync(tomlPath, tomlContent);\r\n        } else {\r\n          fs.writeFileSync(destPath, content);\r\n        }\r\n      } else if (isCodex) {\r\n        content = convertClaudeToCodexMarkdown(content);\r\n        fs.writeFileSync(destPath, content);\r\n      } else {\r\n        fs.writeFileSync(destPath, content);\r\n      }\r\n    } else {\r\n      fs.copyFileSync(srcPath, destPath);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up orphaned files from previous MAXSIM versions\r\n */\r\nfunction cleanupOrphanedFiles(configDir: string): void {\r\n  const orphanedFiles = [\r\n    'hooks/maxsim-notify.sh',\r\n    'hooks/statusline.js',\r\n  ];\r\n\r\n  for (const relPath of orphanedFiles) {\r\n    const fullPath = path.join(configDir, relPath);\r\n    if (fs.existsSync(fullPath)) {\r\n      fs.unlinkSync(fullPath);\r\n      console.log(`  ${green}\\u2713${reset} Removed orphaned ${relPath}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up orphaned hook registrations from settings.json\r\n */\r\nfunction cleanupOrphanedHooks(\r\n  settings: Record<string, unknown>,\r\n): Record<string, unknown> {\r\n  const orphanedHookPatterns = [\r\n    'maxsim-notify.sh',\r\n    'hooks/statusline.js',\r\n    'maxsim-intel-index.js',\r\n    'maxsim-intel-session.js',\r\n    'maxsim-intel-prune.js',\r\n  ];\r\n\r\n  let cleanedHooks = false;\r\n\r\n  interface HookEntry {\r\n    hooks?: Array<{ command?: string }>;\r\n  }\r\n\r\n  const hooks = settings.hooks as Record<string, HookEntry[]> | undefined;\r\n  if (hooks) {\r\n    for (const eventType of Object.keys(hooks)) {\r\n      const hookEntries = hooks[eventType];\r\n      if (Array.isArray(hookEntries)) {\r\n        const filtered = hookEntries.filter((entry: HookEntry) => {\r\n          if (entry.hooks && Array.isArray(entry.hooks)) {\r\n            const hasOrphaned = entry.hooks.some(\r\n              (h) =>\r\n                h.command &&\r\n                orphanedHookPatterns.some((pattern) =>\r\n                  h.command!.includes(pattern),\r\n                ),\r\n            );\r\n            if (hasOrphaned) {\r\n              cleanedHooks = true;\r\n              return false;\r\n            }\r\n          }\r\n          return true;\r\n        });\r\n        hooks[eventType] = filtered;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (cleanedHooks) {\r\n    console.log(\r\n      `  ${green}\\u2713${reset} Removed orphaned hook registrations`,\r\n    );\r\n  }\r\n\r\n  const statusLine = settings.statusLine as { command?: string } | undefined;\r\n  if (\r\n    statusLine &&\r\n    statusLine.command &&\r\n    statusLine.command.includes('statusline.js') &&\r\n    !statusLine.command.includes('maxsim-statusline.js')\r\n  ) {\r\n    statusLine.command = statusLine.command.replace(\r\n      /statusline\\.js/,\r\n      'maxsim-statusline.js',\r\n    );\r\n    console.log(\r\n      `  ${green}\\u2713${reset} Updated statusline path (statusline.js \\u2192 maxsim-statusline.js)`,\r\n    );\r\n  }\r\n\r\n  return settings;\r\n}\r\n\r\n/**\r\n * Uninstall MAXSIM from the specified directory for a specific runtime\r\n */\r\nfunction uninstall(isGlobal: boolean, runtime: RuntimeName = 'claude'): void {\r\n  const isOpencode = runtime === 'opencode';\r\n  const isCodex = runtime === 'codex';\r\n  const dirName = getDirName(runtime);\r\n\r\n  const targetDir = isGlobal\r\n    ? getGlobalDir(runtime, explicitConfigDir)\r\n    : path.join(process.cwd(), dirName);\r\n\r\n  const locationLabel = isGlobal\r\n    ? targetDir.replace(os.homedir(), '~')\r\n    : targetDir.replace(process.cwd(), '.');\r\n\r\n  let runtimeLabel = 'Claude Code';\r\n  if (runtime === 'opencode') runtimeLabel = 'OpenCode';\r\n  if (runtime === 'gemini') runtimeLabel = 'Gemini';\r\n  if (runtime === 'codex') runtimeLabel = 'Codex';\r\n\r\n  console.log(\r\n    `  Uninstalling MAXSIM from ${cyan}${runtimeLabel}${reset} at ${cyan}${locationLabel}${reset}\\n`,\r\n  );\r\n\r\n  if (!fs.existsSync(targetDir)) {\r\n    console.log(\r\n      `  ${yellow}\\u26a0${reset} Directory does not exist: ${locationLabel}`,\r\n    );\r\n    console.log(`  Nothing to uninstall.\\n`);\r\n    return;\r\n  }\r\n\r\n  let removedCount = 0;\r\n\r\n  // 1. Remove MAXSIM commands/skills\r\n  if (isOpencode) {\r\n    const commandDir = path.join(targetDir, 'command');\r\n    if (fs.existsSync(commandDir)) {\r\n      const files = fs.readdirSync(commandDir);\r\n      for (const file of files) {\r\n        if (file.startsWith('maxsim-') && file.endsWith('.md')) {\r\n          fs.unlinkSync(path.join(commandDir, file));\r\n          removedCount++;\r\n        }\r\n      }\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Removed MAXSIM commands from command/`,\r\n      );\r\n    }\r\n  } else if (isCodex) {\r\n    const skillsDir = path.join(targetDir, 'skills');\r\n    if (fs.existsSync(skillsDir)) {\r\n      let skillCount = 0;\r\n      const entries = fs.readdirSync(skillsDir, { withFileTypes: true });\r\n      for (const entry of entries) {\r\n        if (entry.isDirectory() && entry.name.startsWith('maxsim-')) {\r\n          fs.rmSync(path.join(skillsDir, entry.name), { recursive: true });\r\n          skillCount++;\r\n        }\r\n      }\r\n      if (skillCount > 0) {\r\n        removedCount++;\r\n        console.log(\r\n          `  ${green}\\u2713${reset} Removed ${skillCount} Codex skills`,\r\n        );\r\n      }\r\n    }\r\n  } else {\r\n    const maxsimCommandsDir = path.join(targetDir, 'commands', 'maxsim');\r\n    if (fs.existsSync(maxsimCommandsDir)) {\r\n      fs.rmSync(maxsimCommandsDir, { recursive: true });\r\n      removedCount++;\r\n      console.log(`  ${green}\\u2713${reset} Removed commands/maxsim/`);\r\n    }\r\n  }\r\n\r\n  // 2. Remove maxsim directory\r\n  const maxsimDir = path.join(targetDir, 'maxsim');\r\n  if (fs.existsSync(maxsimDir)) {\r\n    fs.rmSync(maxsimDir, { recursive: true });\r\n    removedCount++;\r\n    console.log(`  ${green}\\u2713${reset} Removed maxsim/`);\r\n  }\r\n\r\n  // 3. Remove MAXSIM agents\r\n  const agentsDir = path.join(targetDir, 'agents');\r\n  if (fs.existsSync(agentsDir)) {\r\n    const files = fs.readdirSync(agentsDir);\r\n    let agentCount = 0;\r\n    for (const file of files) {\r\n      if (file.startsWith('maxsim-') && file.endsWith('.md')) {\r\n        fs.unlinkSync(path.join(agentsDir, file));\r\n        agentCount++;\r\n      }\r\n    }\r\n    if (agentCount > 0) {\r\n      removedCount++;\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Removed ${agentCount} MAXSIM agents`,\r\n      );\r\n    }\r\n  }\r\n\r\n  // 4. Remove MAXSIM hooks\r\n  const hooksDir = path.join(targetDir, 'hooks');\r\n  if (fs.existsSync(hooksDir)) {\r\n    const maxsimHooks = [\r\n      'maxsim-statusline.js',\r\n      'maxsim-check-update.js',\r\n      'maxsim-check-update.sh',\r\n      'maxsim-context-monitor.js',\r\n    ];\r\n    let hookCount = 0;\r\n    for (const hook of maxsimHooks) {\r\n      const hookPath = path.join(hooksDir, hook);\r\n      if (fs.existsSync(hookPath)) {\r\n        fs.unlinkSync(hookPath);\r\n        hookCount++;\r\n      }\r\n    }\r\n    if (hookCount > 0) {\r\n      removedCount++;\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Removed ${hookCount} MAXSIM hooks`,\r\n      );\r\n    }\r\n  }\r\n\r\n  // 5. Remove MAXSIM package.json (CommonJS mode marker)\r\n  const pkgJsonPath = path.join(targetDir, 'package.json');\r\n  if (fs.existsSync(pkgJsonPath)) {\r\n    try {\r\n      const content = fs.readFileSync(pkgJsonPath, 'utf8').trim();\r\n      if (content === '{\"type\":\"commonjs\"}') {\r\n        fs.unlinkSync(pkgJsonPath);\r\n        removedCount++;\r\n        console.log(\r\n          `  ${green}\\u2713${reset} Removed MAXSIM package.json`,\r\n        );\r\n      }\r\n    } catch {\r\n      // Ignore read errors\r\n    }\r\n  }\r\n\r\n  // 6. Clean up settings.json\r\n  const settingsPath = path.join(targetDir, 'settings.json');\r\n  if (fs.existsSync(settingsPath)) {\r\n    const settings = readSettings(settingsPath);\r\n    let settingsModified = false;\r\n\r\n    interface StatusLine {\r\n      command?: string;\r\n      url?: string;\r\n    }\r\n\r\n    interface SettingsHookEntry {\r\n      hooks?: Array<{ command?: string }>;\r\n    }\r\n\r\n    const statusLine = settings.statusLine as StatusLine | undefined;\r\n    if (\r\n      statusLine &&\r\n      statusLine.command &&\r\n      statusLine.command.includes('maxsim-statusline')\r\n    ) {\r\n      delete settings.statusLine;\r\n      settingsModified = true;\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Removed MAXSIM statusline from settings`,\r\n      );\r\n    }\r\n\r\n    const settingsHooks = settings.hooks as\r\n      | Record<string, SettingsHookEntry[]>\r\n      | undefined;\r\n    if (settingsHooks && settingsHooks.SessionStart) {\r\n      const before = settingsHooks.SessionStart.length;\r\n      settingsHooks.SessionStart = settingsHooks.SessionStart.filter(\r\n        (entry: SettingsHookEntry) => {\r\n          if (entry.hooks && Array.isArray(entry.hooks)) {\r\n            const hasMaxsimHook = entry.hooks.some(\r\n              (h) =>\r\n                h.command &&\r\n                (h.command.includes('maxsim-check-update') ||\r\n                  h.command.includes('maxsim-statusline')),\r\n            );\r\n            return !hasMaxsimHook;\r\n          }\r\n          return true;\r\n        },\r\n      );\r\n      if (settingsHooks.SessionStart.length < before) {\r\n        settingsModified = true;\r\n        console.log(\r\n          `  ${green}\\u2713${reset} Removed MAXSIM hooks from settings`,\r\n        );\r\n      }\r\n      if (settingsHooks.SessionStart.length === 0) {\r\n        delete settingsHooks.SessionStart;\r\n      }\r\n    }\r\n\r\n    if (settingsHooks && settingsHooks.PostToolUse) {\r\n      const before = settingsHooks.PostToolUse.length;\r\n      settingsHooks.PostToolUse = settingsHooks.PostToolUse.filter(\r\n        (entry: SettingsHookEntry) => {\r\n          if (entry.hooks && Array.isArray(entry.hooks)) {\r\n            const hasMaxsimHook = entry.hooks.some(\r\n              (h) =>\r\n                h.command &&\r\n                h.command.includes('maxsim-context-monitor'),\r\n            );\r\n            return !hasMaxsimHook;\r\n          }\r\n          return true;\r\n        },\r\n      );\r\n      if (settingsHooks.PostToolUse.length < before) {\r\n        settingsModified = true;\r\n        console.log(\r\n          `  ${green}\\u2713${reset} Removed context monitor hook from settings`,\r\n        );\r\n      }\r\n      if (settingsHooks.PostToolUse.length === 0) {\r\n        delete settingsHooks.PostToolUse;\r\n      }\r\n    }\r\n\r\n    if (settingsHooks && Object.keys(settingsHooks).length === 0) {\r\n      delete settings.hooks;\r\n    }\r\n\r\n    if (settingsModified) {\r\n      writeSettings(settingsPath, settings);\r\n      removedCount++;\r\n    }\r\n  }\r\n\r\n  // 7. For OpenCode, clean up permissions from opencode.json\r\n  if (isOpencode) {\r\n    const opencodeConfigDir = isGlobal\r\n      ? getOpencodeGlobalDir()\r\n      : path.join(process.cwd(), '.opencode');\r\n    const configPath = path.join(opencodeConfigDir, 'opencode.json');\r\n    if (fs.existsSync(configPath)) {\r\n      try {\r\n        const config = JSON.parse(\r\n          fs.readFileSync(configPath, 'utf8'),\r\n        ) as Record<string, unknown>;\r\n        let modified = false;\r\n\r\n        const permission = config.permission as\r\n          | Record<string, Record<string, unknown>>\r\n          | undefined;\r\n        if (permission) {\r\n          for (const permType of ['read', 'external_directory'] as const) {\r\n            if (permission[permType]) {\r\n              const keys = Object.keys(permission[permType]);\r\n              for (const key of keys) {\r\n                if (key.includes('maxsim')) {\r\n                  delete permission[permType][key];\r\n                  modified = true;\r\n                }\r\n              }\r\n              if (Object.keys(permission[permType]).length === 0) {\r\n                delete permission[permType];\r\n              }\r\n            }\r\n          }\r\n          if (Object.keys(permission).length === 0) {\r\n            delete config.permission;\r\n          }\r\n        }\r\n\r\n        if (modified) {\r\n          fs.writeFileSync(\r\n            configPath,\r\n            JSON.stringify(config, null, 2) + '\\n',\r\n          );\r\n          removedCount++;\r\n          console.log(\r\n            `  ${green}\\u2713${reset} Removed MAXSIM permissions from opencode.json`,\r\n          );\r\n        }\r\n      } catch {\r\n        // Ignore JSON parse errors\r\n      }\r\n    }\r\n  }\r\n\r\n  if (removedCount === 0) {\r\n    console.log(\r\n      `  ${yellow}\\u26a0${reset} No MAXSIM files found to remove.`,\r\n    );\r\n  }\r\n\r\n  console.log(`\r\n  ${green}Done!${reset} MAXSIM has been uninstalled from ${runtimeLabel}.\r\n  Your other files and settings have been preserved.\r\n`);\r\n}\r\n\r\n/**\r\n * Parse JSONC (JSON with Comments) by stripping comments and trailing commas.\r\n */\r\nfunction parseJsonc(content: string): Record<string, unknown> {\r\n  if (content.charCodeAt(0) === 0xfeff) {\r\n    content = content.slice(1);\r\n  }\r\n\r\n  let result = '';\r\n  let inString = false;\r\n  let i = 0;\r\n  while (i < content.length) {\r\n    const char = content[i];\r\n    const next = content[i + 1];\r\n\r\n    if (inString) {\r\n      result += char;\r\n      if (char === '\\\\' && i + 1 < content.length) {\r\n        result += next;\r\n        i += 2;\r\n        continue;\r\n      }\r\n      if (char === '\"') {\r\n        inString = false;\r\n      }\r\n      i++;\r\n    } else {\r\n      if (char === '\"') {\r\n        inString = true;\r\n        result += char;\r\n        i++;\r\n      } else if (char === '/' && next === '/') {\r\n        while (i < content.length && content[i] !== '\\n') {\r\n          i++;\r\n        }\r\n      } else if (char === '/' && next === '*') {\r\n        i += 2;\r\n        while (\r\n          i < content.length - 1 &&\r\n          !(content[i] === '*' && content[i + 1] === '/')\r\n        ) {\r\n          i++;\r\n        }\r\n        i += 2;\r\n      } else {\r\n        result += char;\r\n        i++;\r\n      }\r\n    }\r\n  }\r\n\r\n  result = result.replace(/,(\\s*[}\\]])/g, '$1');\r\n\r\n  return JSON.parse(result) as Record<string, unknown>;\r\n}\r\n\r\n/**\r\n * Configure OpenCode permissions to allow reading MAXSIM reference docs\r\n */\r\nfunction configureOpencodePermissions(isGlobal: boolean = true): void {\r\n  const opencodeConfigDir = isGlobal\r\n    ? getOpencodeGlobalDir()\r\n    : path.join(process.cwd(), '.opencode');\r\n  const configPath = path.join(opencodeConfigDir, 'opencode.json');\r\n\r\n  fs.mkdirSync(opencodeConfigDir, { recursive: true });\r\n\r\n  let config: Record<string, unknown> = {};\r\n  if (fs.existsSync(configPath)) {\r\n    try {\r\n      const content = fs.readFileSync(configPath, 'utf8');\r\n      config = parseJsonc(content);\r\n    } catch (e: unknown) {\r\n      console.log(\r\n        `  ${yellow}\\u26a0${reset} Could not parse opencode.json - skipping permission config`,\r\n      );\r\n      console.log(\r\n        `    ${dim}Reason: ${(e as Error).message}${reset}`,\r\n      );\r\n      console.log(\r\n        `    ${dim}Your config was NOT modified. Fix the syntax manually if needed.${reset}`,\r\n      );\r\n      return;\r\n    }\r\n  }\r\n\r\n  type PermissionConfig = Record<string, Record<string, string>>;\r\n  if (!config.permission) {\r\n    config.permission = {} as PermissionConfig;\r\n  }\r\n  const permission = config.permission as PermissionConfig;\r\n\r\n  const defaultConfigDir = path.join(os.homedir(), '.config', 'opencode');\r\n  const maxsimPath =\r\n    opencodeConfigDir === defaultConfigDir\r\n      ? '~/.config/opencode/maxsim/*'\r\n      : `${opencodeConfigDir.replace(/\\\\/g, '/')}/maxsim/*`;\r\n\r\n  let modified = false;\r\n\r\n  if (!permission.read || typeof permission.read !== 'object') {\r\n    permission.read = {};\r\n  }\r\n  if (permission.read[maxsimPath] !== 'allow') {\r\n    permission.read[maxsimPath] = 'allow';\r\n    modified = true;\r\n  }\r\n\r\n  if (\r\n    !permission.external_directory ||\r\n    typeof permission.external_directory !== 'object'\r\n  ) {\r\n    permission.external_directory = {};\r\n  }\r\n  if (permission.external_directory[maxsimPath] !== 'allow') {\r\n    permission.external_directory[maxsimPath] = 'allow';\r\n    modified = true;\r\n  }\r\n\r\n  if (!modified) {\r\n    return;\r\n  }\r\n\r\n  fs.writeFileSync(configPath, JSON.stringify(config, null, 2) + '\\n');\r\n  console.log(\r\n    `  ${green}\\u2713${reset} Configured read permission for MAXSIM docs`,\r\n  );\r\n}\r\n\r\n/**\r\n * Verify a directory exists and contains files\r\n */\r\nfunction verifyInstalled(dirPath: string, description: string): boolean {\r\n  if (!fs.existsSync(dirPath)) {\r\n    console.error(\r\n      `  ${yellow}\\u2717${reset} Failed to install ${description}: directory not created`,\r\n    );\r\n    return false;\r\n  }\r\n  try {\r\n    const entries = fs.readdirSync(dirPath);\r\n    if (entries.length === 0) {\r\n      console.error(\r\n        `  ${yellow}\\u2717${reset} Failed to install ${description}: directory is empty`,\r\n      );\r\n      return false;\r\n    }\r\n  } catch (e: unknown) {\r\n    console.error(\r\n      `  ${yellow}\\u2717${reset} Failed to install ${description}: ${(e as Error).message}`,\r\n    );\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * Verify a file exists\r\n */\r\nfunction verifyFileInstalled(filePath: string, description: string): boolean {\r\n  if (!fs.existsSync(filePath)) {\r\n    console.error(\r\n      `  ${yellow}\\u2717${reset} Failed to install ${description}: file not created`,\r\n    );\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\n// ──────────────────────────────────────────────────────\r\n// Local Patch Persistence\r\n// ──────────────────────────────────────────────────────\r\n\r\nconst PATCHES_DIR_NAME = 'maxsim-local-patches';\r\nconst MANIFEST_NAME = 'maxsim-file-manifest.json';\r\n\r\n/**\r\n * Compute SHA256 hash of file contents\r\n */\r\nfunction fileHash(filePath: string): string {\r\n  const content = fs.readFileSync(filePath);\r\n  return crypto.createHash('sha256').update(content).digest('hex');\r\n}\r\n\r\n/**\r\n * Recursively collect all files in dir with their hashes\r\n */\r\nfunction generateManifest(\r\n  dir: string,\r\n  baseDir?: string,\r\n): Record<string, string> {\r\n  if (!baseDir) baseDir = dir;\r\n  const manifest: Record<string, string> = {};\r\n  if (!fs.existsSync(dir)) return manifest;\r\n  const entries = fs.readdirSync(dir, { withFileTypes: true });\r\n  for (const entry of entries) {\r\n    const fullPath = path.join(dir, entry.name);\r\n    const relPath = path.relative(baseDir, fullPath).replace(/\\\\/g, '/');\r\n    if (entry.isDirectory()) {\r\n      Object.assign(manifest, generateManifest(fullPath, baseDir));\r\n    } else {\r\n      manifest[relPath] = fileHash(fullPath);\r\n    }\r\n  }\r\n  return manifest;\r\n}\r\n\r\ninterface Manifest {\r\n  version: string;\r\n  timestamp: string;\r\n  files: Record<string, string>;\r\n}\r\n\r\n/**\r\n * Write file manifest after installation for future modification detection\r\n */\r\nfunction writeManifest(\r\n  configDir: string,\r\n  runtime: RuntimeName = 'claude',\r\n): Manifest {\r\n  const isOpencode = runtime === 'opencode';\r\n  const isCodex = runtime === 'codex';\r\n  const maxsimDir = path.join(configDir, 'maxsim');\r\n  const commandsDir = path.join(configDir, 'commands', 'maxsim');\r\n  const opencodeCommandDir = path.join(configDir, 'command');\r\n  const codexSkillsDir = path.join(configDir, 'skills');\r\n  const agentsDir = path.join(configDir, 'agents');\r\n  const manifest: Manifest = {\r\n    version: pkg.version,\r\n    timestamp: new Date().toISOString(),\r\n    files: {},\r\n  };\r\n\r\n  const maxsimHashes = generateManifest(maxsimDir);\r\n  for (const [rel, hash] of Object.entries(maxsimHashes)) {\r\n    manifest.files['maxsim/' + rel] = hash;\r\n  }\r\n  if (!isOpencode && !isCodex && fs.existsSync(commandsDir)) {\r\n    const cmdHashes = generateManifest(commandsDir);\r\n    for (const [rel, hash] of Object.entries(cmdHashes)) {\r\n      manifest.files['commands/maxsim/' + rel] = hash;\r\n    }\r\n  }\r\n  if (isOpencode && fs.existsSync(opencodeCommandDir)) {\r\n    for (const file of fs.readdirSync(opencodeCommandDir)) {\r\n      if (file.startsWith('maxsim-') && file.endsWith('.md')) {\r\n        manifest.files['command/' + file] = fileHash(\r\n          path.join(opencodeCommandDir, file),\r\n        );\r\n      }\r\n    }\r\n  }\r\n  if (isCodex && fs.existsSync(codexSkillsDir)) {\r\n    for (const skillName of listCodexSkillNames(codexSkillsDir)) {\r\n      const skillRoot = path.join(codexSkillsDir, skillName);\r\n      const skillHashes = generateManifest(skillRoot);\r\n      for (const [rel, hash] of Object.entries(skillHashes)) {\r\n        manifest.files[`skills/${skillName}/${rel}`] = hash;\r\n      }\r\n    }\r\n  }\r\n  if (fs.existsSync(agentsDir)) {\r\n    for (const file of fs.readdirSync(agentsDir)) {\r\n      if (file.startsWith('maxsim-') && file.endsWith('.md')) {\r\n        manifest.files['agents/' + file] = fileHash(\r\n          path.join(agentsDir, file),\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  fs.writeFileSync(\r\n    path.join(configDir, MANIFEST_NAME),\r\n    JSON.stringify(manifest, null, 2),\r\n  );\r\n  return manifest;\r\n}\r\n\r\ninterface BackupMeta {\r\n  backed_up_at: string;\r\n  from_version: string;\r\n  files: string[];\r\n}\r\n\r\n/**\r\n * Detect user-modified MAXSIM files by comparing against install manifest.\r\n */\r\nfunction saveLocalPatches(configDir: string): string[] {\r\n  const manifestPath = path.join(configDir, MANIFEST_NAME);\r\n  if (!fs.existsSync(manifestPath)) return [];\r\n\r\n  let manifest: Manifest;\r\n  try {\r\n    manifest = JSON.parse(\r\n      fs.readFileSync(manifestPath, 'utf8'),\r\n    ) as Manifest;\r\n  } catch {\r\n    return [];\r\n  }\r\n\r\n  const patchesDir = path.join(configDir, PATCHES_DIR_NAME);\r\n  const modified: string[] = [];\r\n\r\n  for (const [relPath, originalHash] of Object.entries(manifest.files || {})) {\r\n    const fullPath = path.join(configDir, relPath);\r\n    if (!fs.existsSync(fullPath)) continue;\r\n    const currentHash = fileHash(fullPath);\r\n    if (currentHash !== originalHash) {\r\n      const backupPath = path.join(patchesDir, relPath);\r\n      fs.mkdirSync(path.dirname(backupPath), { recursive: true });\r\n      fs.copyFileSync(fullPath, backupPath);\r\n      modified.push(relPath);\r\n    }\r\n  }\r\n\r\n  if (modified.length > 0) {\r\n    const meta: BackupMeta = {\r\n      backed_up_at: new Date().toISOString(),\r\n      from_version: manifest.version,\r\n      files: modified,\r\n    };\r\n    fs.writeFileSync(\r\n      path.join(patchesDir, 'backup-meta.json'),\r\n      JSON.stringify(meta, null, 2),\r\n    );\r\n    console.log(\r\n      '  ' +\r\n        yellow +\r\n        'i' +\r\n        reset +\r\n        '  Found ' +\r\n        modified.length +\r\n        ' locally modified MAXSIM file(s) \\u2014 backed up to ' +\r\n        PATCHES_DIR_NAME +\r\n        '/',\r\n    );\r\n    for (const f of modified) {\r\n      console.log('     ' + dim + f + reset);\r\n    }\r\n  }\r\n  return modified;\r\n}\r\n\r\n/**\r\n * After install, report backed-up patches for user to reapply.\r\n */\r\nfunction reportLocalPatches(\r\n  configDir: string,\r\n  runtime: RuntimeName = 'claude',\r\n): string[] {\r\n  const patchesDir = path.join(configDir, PATCHES_DIR_NAME);\r\n  const metaPath = path.join(patchesDir, 'backup-meta.json');\r\n  if (!fs.existsSync(metaPath)) return [];\r\n\r\n  let meta: BackupMeta;\r\n  try {\r\n    meta = JSON.parse(\r\n      fs.readFileSync(metaPath, 'utf8'),\r\n    ) as BackupMeta;\r\n  } catch {\r\n    return [];\r\n  }\r\n\r\n  if (meta.files && meta.files.length > 0) {\r\n    const reapplyCommand =\r\n      runtime === 'opencode'\r\n        ? '/maxsim-reapply-patches'\r\n        : runtime === 'codex'\r\n          ? '$maxsim-reapply-patches'\r\n          : '/maxsim:reapply-patches';\r\n    console.log('');\r\n    console.log(\r\n      '  ' +\r\n        yellow +\r\n        'Local patches detected' +\r\n        reset +\r\n        ' (from v' +\r\n        meta.from_version +\r\n        '):',\r\n    );\r\n    for (const f of meta.files) {\r\n      console.log('     ' + cyan + f + reset);\r\n    }\r\n    console.log('');\r\n    console.log(\r\n      '  Your modifications are saved in ' +\r\n        cyan +\r\n        PATCHES_DIR_NAME +\r\n        '/' +\r\n        reset,\r\n    );\r\n    console.log(\r\n      '  Run ' +\r\n        cyan +\r\n        reapplyCommand +\r\n        reset +\r\n        ' to merge them into the new version.',\r\n    );\r\n    console.log('  Or manually compare and merge the files.');\r\n    console.log('');\r\n  }\r\n  return meta.files || [];\r\n}\r\n\r\ninterface InstallResult {\r\n  settingsPath: string | null;\r\n  settings: Record<string, unknown> | null;\r\n  statuslineCommand: string | null;\r\n  runtime: RuntimeName;\r\n}\r\n\r\nfunction install(\r\n  isGlobal: boolean,\r\n  runtime: RuntimeName = 'claude',\r\n): InstallResult {\r\n  const isOpencode = runtime === 'opencode';\r\n  const isGemini = runtime === 'gemini';\r\n  const isCodex = runtime === 'codex';\r\n  const dirName = getDirName(runtime);\r\n  const src = templatesRoot;\r\n\r\n  const targetDir = isGlobal\r\n    ? getGlobalDir(runtime, explicitConfigDir)\r\n    : path.join(process.cwd(), dirName);\r\n\r\n  const locationLabel = isGlobal\r\n    ? targetDir.replace(os.homedir(), '~')\r\n    : targetDir.replace(process.cwd(), '.');\r\n\r\n  const pathPrefix = isGlobal\r\n    ? `${targetDir.replace(/\\\\/g, '/')}/`\r\n    : `./${dirName}/`;\r\n\r\n  let runtimeLabel = 'Claude Code';\r\n  if (isOpencode) runtimeLabel = 'OpenCode';\r\n  if (isGemini) runtimeLabel = 'Gemini';\r\n  if (isCodex) runtimeLabel = 'Codex';\r\n\r\n  console.log(\r\n    `  Installing for ${cyan}${runtimeLabel}${reset} to ${cyan}${locationLabel}${reset}\\n`,\r\n  );\r\n\r\n  const failures: string[] = [];\r\n\r\n  // Save any locally modified MAXSIM files before they get wiped\r\n  saveLocalPatches(targetDir);\r\n\r\n  // Clean up orphaned files from previous versions\r\n  cleanupOrphanedFiles(targetDir);\r\n\r\n  // OpenCode uses command/ (flat), Codex uses skills/, Claude/Gemini use commands/maxsim/\r\n  if (isOpencode) {\r\n    const commandDir = path.join(targetDir, 'command');\r\n    fs.mkdirSync(commandDir, { recursive: true });\r\n\r\n    const maxsimSrc = path.join(src, 'commands', 'maxsim');\r\n    copyFlattenedCommands(maxsimSrc, commandDir, 'maxsim', pathPrefix, runtime);\r\n    if (verifyInstalled(commandDir, 'command/maxsim-*')) {\r\n      const count = fs\r\n        .readdirSync(commandDir)\r\n        .filter((f) => f.startsWith('maxsim-')).length;\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Installed ${count} commands to command/`,\r\n      );\r\n    } else {\r\n      failures.push('command/maxsim-*');\r\n    }\r\n  } else if (isCodex) {\r\n    const skillsDir = path.join(targetDir, 'skills');\r\n    const maxsimSrc = path.join(src, 'commands', 'maxsim');\r\n    copyCommandsAsCodexSkills(maxsimSrc, skillsDir, 'maxsim', pathPrefix, runtime);\r\n    const installedSkillNames = listCodexSkillNames(skillsDir);\r\n    if (installedSkillNames.length > 0) {\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Installed ${installedSkillNames.length} skills to skills/`,\r\n      );\r\n    } else {\r\n      failures.push('skills/maxsim-*');\r\n    }\r\n  } else {\r\n    const commandsDir = path.join(targetDir, 'commands');\r\n    fs.mkdirSync(commandsDir, { recursive: true });\r\n\r\n    const maxsimSrc = path.join(src, 'commands', 'maxsim');\r\n    const maxsimDest = path.join(commandsDir, 'maxsim');\r\n    copyWithPathReplacement(maxsimSrc, maxsimDest, pathPrefix, runtime, true);\r\n    if (verifyInstalled(maxsimDest, 'commands/maxsim')) {\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Installed commands/maxsim`,\r\n      );\r\n    } else {\r\n      failures.push('commands/maxsim');\r\n    }\r\n  }\r\n\r\n  // Copy maxsim directory content (workflows, templates, references) with path replacement\r\n  // Templates package layout: workflows/, templates/, references/ at root\r\n  // Install target: maxsim/workflows/, maxsim/templates/, maxsim/references/\r\n  const skillDest = path.join(targetDir, 'maxsim');\r\n  const maxsimSubdirs = ['workflows', 'templates', 'references'];\r\n  if (fs.existsSync(skillDest)) {\r\n    fs.rmSync(skillDest, { recursive: true });\r\n  }\r\n  fs.mkdirSync(skillDest, { recursive: true });\r\n  for (const subdir of maxsimSubdirs) {\r\n    const subdirSrc = path.join(src, subdir);\r\n    if (fs.existsSync(subdirSrc)) {\r\n      const subdirDest = path.join(skillDest, subdir);\r\n      copyWithPathReplacement(subdirSrc, subdirDest, pathPrefix, runtime);\r\n    }\r\n  }\r\n  if (verifyInstalled(skillDest, 'maxsim')) {\r\n    console.log(`  ${green}\\u2713${reset} Installed maxsim`);\r\n  } else {\r\n    failures.push('maxsim');\r\n  }\r\n\r\n  // Copy agents to agents directory\r\n  const agentsSrc = path.join(src, 'agents');\r\n  if (fs.existsSync(agentsSrc)) {\r\n    const agentsDest = path.join(targetDir, 'agents');\r\n    fs.mkdirSync(agentsDest, { recursive: true });\r\n\r\n    // Remove old MAXSIM agents before copying new ones\r\n    if (fs.existsSync(agentsDest)) {\r\n      for (const file of fs.readdirSync(agentsDest)) {\r\n        if (file.startsWith('maxsim-') && file.endsWith('.md')) {\r\n          fs.unlinkSync(path.join(agentsDest, file));\r\n        }\r\n      }\r\n    }\r\n\r\n    const agentEntries = fs.readdirSync(agentsSrc, { withFileTypes: true });\r\n    for (const entry of agentEntries) {\r\n      if (entry.isFile() && entry.name.endsWith('.md')) {\r\n        let content = fs.readFileSync(\r\n          path.join(agentsSrc, entry.name),\r\n          'utf8',\r\n        );\r\n        const dirRegex = /~\\/\\.claude\\//g;\r\n        content = content.replace(dirRegex, pathPrefix);\r\n        content = processAttribution(content, getCommitAttribution(runtime));\r\n        if (isOpencode) {\r\n          content = convertClaudeToOpencodeFrontmatter(content);\r\n        } else if (isGemini) {\r\n          content = convertClaudeToGeminiAgent(content);\r\n        } else if (isCodex) {\r\n          content = convertClaudeToCodexMarkdown(content);\r\n        }\r\n        fs.writeFileSync(path.join(agentsDest, entry.name), content);\r\n      }\r\n    }\r\n    if (verifyInstalled(agentsDest, 'agents')) {\r\n      console.log(`  ${green}\\u2713${reset} Installed agents`);\r\n    } else {\r\n      failures.push('agents');\r\n    }\r\n  }\r\n\r\n  // Copy CHANGELOG.md (lives at repo root, one level above templates package)\r\n  const changelogSrc = path.join(src, '..', 'CHANGELOG.md');\r\n  const changelogDest = path.join(targetDir, 'maxsim', 'CHANGELOG.md');\r\n  if (fs.existsSync(changelogSrc)) {\r\n    fs.copyFileSync(changelogSrc, changelogDest);\r\n    if (verifyFileInstalled(changelogDest, 'CHANGELOG.md')) {\r\n      console.log(`  ${green}\\u2713${reset} Installed CHANGELOG.md`);\r\n    } else {\r\n      failures.push('CHANGELOG.md');\r\n    }\r\n  }\r\n\r\n  // Copy CLAUDE.md (global MAXSIM context for Claude Code)\r\n  const claudeMdSrc = path.join(src, 'CLAUDE.md');\r\n  const claudeMdDest = path.join(targetDir, 'CLAUDE.md');\r\n  if (fs.existsSync(claudeMdSrc)) {\r\n    fs.copyFileSync(claudeMdSrc, claudeMdDest);\r\n    if (verifyFileInstalled(claudeMdDest, 'CLAUDE.md')) {\r\n      console.log(`  ${green}\\u2713${reset} Installed CLAUDE.md`);\r\n    } else {\r\n      failures.push('CLAUDE.md');\r\n    }\r\n  }\r\n\r\n  // Write VERSION file\r\n  const versionDest = path.join(targetDir, 'maxsim', 'VERSION');\r\n  fs.writeFileSync(versionDest, pkg.version);\r\n  if (verifyFileInstalled(versionDest, 'VERSION')) {\r\n    console.log(\r\n      `  ${green}\\u2713${reset} Wrote VERSION (${pkg.version})`,\r\n    );\r\n  } else {\r\n    failures.push('VERSION');\r\n  }\r\n\r\n  if (!isCodex) {\r\n    // Write package.json to force CommonJS mode for MAXSIM scripts\r\n    const pkgJsonDest = path.join(targetDir, 'package.json');\r\n    fs.writeFileSync(pkgJsonDest, '{\"type\":\"commonjs\"}\\n');\r\n    console.log(\r\n      `  ${green}\\u2713${reset} Wrote package.json (CommonJS mode)`,\r\n    );\r\n\r\n    // Copy hooks from bundled assets directory (copied from @maxsim/hooks/dist at build time)\r\n    let hooksSrc: string | null = null;\r\n    const bundledHooksDir = path.resolve(__dirname, 'assets', 'hooks');\r\n    if (fs.existsSync(bundledHooksDir)) {\r\n      hooksSrc = bundledHooksDir;\r\n    } else {\r\n      console.warn(`  ${yellow}!${reset} bundled hooks not found - hooks will not be installed`);\r\n    }\r\n\r\n    if (hooksSrc) {\r\n      const hooksDest = path.join(targetDir, 'hooks');\r\n      fs.mkdirSync(hooksDest, { recursive: true });\r\n      const hookEntries = fs.readdirSync(hooksSrc);\r\n      const configDirReplacement = getConfigDirFromHome(runtime, isGlobal);\r\n      for (const entry of hookEntries) {\r\n        const srcFile = path.join(hooksSrc, entry);\r\n        if (fs.statSync(srcFile).isFile() && entry.endsWith('.cjs') && !entry.includes('.d.')) {\r\n          const destName = entry.replace(/\\.cjs$/, '.js');\r\n          const destFile = path.join(hooksDest, destName);\r\n          let content = fs.readFileSync(srcFile, 'utf8');\r\n          content = content.replace(/'\\.claude'/g, configDirReplacement);\r\n          fs.writeFileSync(destFile, content);\r\n        }\r\n      }\r\n      if (verifyInstalled(hooksDest, 'hooks')) {\r\n        console.log(\r\n          `  ${green}\\u2713${reset} Installed hooks (bundled)`,\r\n        );\r\n      } else {\r\n        failures.push('hooks');\r\n      }\r\n    }\r\n  }\r\n\r\n  if (failures.length > 0) {\r\n    console.error(\r\n      `\\n  ${yellow}Installation incomplete!${reset} Failed: ${failures.join(', ')}`,\r\n    );\r\n    process.exit(1);\r\n  }\r\n\r\n  // Write file manifest for future modification detection\r\n  writeManifest(targetDir, runtime);\r\n  console.log(\r\n    `  ${green}\\u2713${reset} Wrote file manifest (${MANIFEST_NAME})`,\r\n  );\r\n\r\n  // Report any backed-up local patches\r\n  reportLocalPatches(targetDir, runtime);\r\n\r\n  if (isCodex) {\r\n    return {\r\n      settingsPath: null,\r\n      settings: null,\r\n      statuslineCommand: null,\r\n      runtime,\r\n    };\r\n  }\r\n\r\n  // Configure statusline and hooks in settings.json\r\n  const settingsPath = path.join(targetDir, 'settings.json');\r\n  const settings = cleanupOrphanedHooks(readSettings(settingsPath));\r\n  const statuslineCommand = isGlobal\r\n    ? buildHookCommand(targetDir, 'maxsim-statusline.js')\r\n    : 'node ' + dirName + '/hooks/maxsim-statusline.js';\r\n  const updateCheckCommand = isGlobal\r\n    ? buildHookCommand(targetDir, 'maxsim-check-update.js')\r\n    : 'node ' + dirName + '/hooks/maxsim-check-update.js';\r\n  const contextMonitorCommand = isGlobal\r\n    ? buildHookCommand(targetDir, 'maxsim-context-monitor.js')\r\n    : 'node ' + dirName + '/hooks/maxsim-context-monitor.js';\r\n\r\n  // Enable experimental agents for Gemini CLI\r\n  if (isGemini) {\r\n    if (!settings.experimental) {\r\n      settings.experimental = {};\r\n    }\r\n    const experimental = settings.experimental as Record<string, boolean>;\r\n    if (!experimental.enableAgents) {\r\n      experimental.enableAgents = true;\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Enabled experimental agents`,\r\n      );\r\n    }\r\n  }\r\n\r\n  interface InstallHookEntry {\r\n    hooks?: Array<{ type: string; command: string }>;\r\n  }\r\n\r\n  // Configure SessionStart hook for update checking (skip for opencode)\r\n  if (!isOpencode) {\r\n    if (!settings.hooks) {\r\n      settings.hooks = {};\r\n    }\r\n    const installHooks = settings.hooks as Record<string, InstallHookEntry[]>;\r\n    if (!installHooks.SessionStart) {\r\n      installHooks.SessionStart = [];\r\n    }\r\n\r\n    const hasMaxsimUpdateHook = installHooks.SessionStart.some(\r\n      (entry: InstallHookEntry) =>\r\n        entry.hooks &&\r\n        entry.hooks.some(\r\n          (h) => h.command && h.command.includes('maxsim-check-update'),\r\n        ),\r\n    );\r\n\r\n    if (!hasMaxsimUpdateHook) {\r\n      installHooks.SessionStart.push({\r\n        hooks: [\r\n          {\r\n            type: 'command',\r\n            command: updateCheckCommand,\r\n          },\r\n        ],\r\n      });\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Configured update check hook`,\r\n      );\r\n    }\r\n\r\n    // Configure PostToolUse hook for context window monitoring\r\n    if (!installHooks.PostToolUse) {\r\n      installHooks.PostToolUse = [];\r\n    }\r\n\r\n    const hasContextMonitorHook = installHooks.PostToolUse.some(\r\n      (entry: InstallHookEntry) =>\r\n        entry.hooks &&\r\n        entry.hooks.some(\r\n          (h) => h.command && h.command.includes('maxsim-context-monitor'),\r\n        ),\r\n    );\r\n\r\n    if (!hasContextMonitorHook) {\r\n      installHooks.PostToolUse.push({\r\n        hooks: [\r\n          {\r\n            type: 'command',\r\n            command: contextMonitorCommand,\r\n          },\r\n        ],\r\n      });\r\n      console.log(\r\n        `  ${green}\\u2713${reset} Configured context window monitor hook`,\r\n      );\r\n    }\r\n  }\r\n\r\n  return { settingsPath, settings, statuslineCommand, runtime };\r\n}\r\n\r\n/**\r\n * Apply statusline config, then print completion message\r\n */\r\nfunction finishInstall(\r\n  settingsPath: string | null,\r\n  settings: Record<string, unknown> | null,\r\n  statuslineCommand: string | null,\r\n  shouldInstallStatusline: boolean,\r\n  runtime: RuntimeName = 'claude',\r\n  isGlobal: boolean = true,\r\n): void {\r\n  const isOpencode = runtime === 'opencode';\r\n  const isCodex = runtime === 'codex';\r\n\r\n  if (shouldInstallStatusline && !isOpencode && !isCodex) {\r\n    settings!.statusLine = {\r\n      type: 'command',\r\n      command: statuslineCommand,\r\n    };\r\n    console.log(`  ${green}\\u2713${reset} Configured statusline`);\r\n  }\r\n\r\n  if (!isCodex && settingsPath && settings) {\r\n    writeSettings(settingsPath, settings);\r\n  }\r\n\r\n  if (isOpencode) {\r\n    configureOpencodePermissions(isGlobal);\r\n  }\r\n\r\n  let program = 'Claude Code';\r\n  if (runtime === 'opencode') program = 'OpenCode';\r\n  if (runtime === 'gemini') program = 'Gemini';\r\n  if (runtime === 'codex') program = 'Codex';\r\n\r\n  let command = '/maxsim:help';\r\n  if (runtime === 'opencode') command = '/maxsim-help';\r\n  if (runtime === 'codex') command = '$maxsim-help';\r\n  console.log(`\r\n  ${green}Done!${reset} Launch ${program} and run ${cyan}${command}${reset}.\r\n\r\n  ${cyan}Join the community:${reset} https://discord.gg/5JJgD5svVS\r\n`);\r\n}\r\n\r\n/**\r\n * Handle statusline configuration with optional prompt\r\n */\r\nfunction handleStatusline(\r\n  settings: Record<string, unknown>,\r\n  isInteractive: boolean,\r\n  callback: (shouldInstall: boolean) => void,\r\n): void {\r\n  const hasExisting = settings.statusLine != null;\r\n\r\n  if (!hasExisting) {\r\n    callback(true);\r\n    return;\r\n  }\r\n\r\n  if (forceStatusline) {\r\n    callback(true);\r\n    return;\r\n  }\r\n\r\n  if (!isInteractive) {\r\n    console.log(\r\n      `  ${yellow}\\u26a0${reset} Skipping statusline (already configured)`,\r\n    );\r\n    console.log(\r\n      `    Use ${cyan}--force-statusline${reset} to replace\\n`,\r\n    );\r\n    callback(false);\r\n    return;\r\n  }\r\n\r\n  const statusLine = settings.statusLine as { command?: string; url?: string };\r\n  const existingCmd = statusLine.command || statusLine.url || '(custom)';\r\n\r\n  const rl = readline.createInterface({\r\n    input: process.stdin,\r\n    output: process.stdout,\r\n  });\r\n\r\n  console.log(`\r\n  ${yellow}\\u26a0${reset} Existing statusline detected\\n\r\n  Your current statusline:\r\n    ${dim}command: ${existingCmd}${reset}\r\n\r\n  MAXSIM includes a statusline showing:\r\n    \\u2022 Model name\r\n    \\u2022 Current task (from todo list)\r\n    \\u2022 Context window usage (color-coded)\r\n\r\n  ${cyan}1${reset}) Keep existing\r\n  ${cyan}2${reset}) Replace with MAXSIM statusline\r\n`);\r\n\r\n  rl.question(`  Choice ${dim}[1]${reset}: `, (answer: string) => {\r\n    rl.close();\r\n    const choice = answer.trim() || '1';\r\n    callback(choice === '2');\r\n  });\r\n}\r\n\r\n/**\r\n * Prompt for runtime selection\r\n */\r\nfunction promptRuntime(callback: (runtimes: RuntimeName[]) => void): void {\r\n  const rl = readline.createInterface({\r\n    input: process.stdin,\r\n    output: process.stdout,\r\n  });\r\n\r\n  let answered = false;\r\n\r\n  rl.on('close', () => {\r\n    if (!answered) {\r\n      answered = true;\r\n      console.log(`\\n  ${yellow}Installation cancelled${reset}\\n`);\r\n      process.exit(0);\r\n    }\r\n  });\r\n\r\n  console.log(\r\n    `  ${yellow}Which runtime(s) would you like to install for?${reset}\\n\\n  ${cyan}1${reset}) Claude Code ${dim}(~/.claude)${reset}\r\n  ${cyan}2${reset}) OpenCode    ${dim}(~/.config/opencode)${reset} - open source, free models\r\n  ${cyan}3${reset}) Gemini      ${dim}(~/.gemini)${reset}\r\n  ${cyan}4${reset}) Codex       ${dim}(~/.codex)${reset}\r\n  ${cyan}5${reset}) All\r\n`,\r\n  );\r\n\r\n  rl.question(`  Choice ${dim}[1]${reset}: `, (answer: string) => {\r\n    answered = true;\r\n    rl.close();\r\n    const choice = answer.trim() || '1';\r\n    if (choice === '5') {\r\n      callback(['claude', 'opencode', 'gemini', 'codex']);\r\n    } else if (choice === '4') {\r\n      callback(['codex']);\r\n    } else if (choice === '3') {\r\n      callback(['gemini']);\r\n    } else if (choice === '2') {\r\n      callback(['opencode']);\r\n    } else {\r\n      callback(['claude']);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Prompt for install location\r\n */\r\nfunction promptLocation(runtimes: RuntimeName[]): void {\r\n  if (!process.stdin.isTTY) {\r\n    console.log(\r\n      `  ${yellow}Non-interactive terminal detected, defaulting to global install${reset}\\n`,\r\n    );\r\n    installAllRuntimes(runtimes, true, false);\r\n    return;\r\n  }\r\n\r\n  const rl = readline.createInterface({\r\n    input: process.stdin,\r\n    output: process.stdout,\r\n  });\r\n\r\n  let answered = false;\r\n\r\n  rl.on('close', () => {\r\n    if (!answered) {\r\n      answered = true;\r\n      console.log(`\\n  ${yellow}Installation cancelled${reset}\\n`);\r\n      process.exit(0);\r\n    }\r\n  });\r\n\r\n  const pathExamples = runtimes\r\n    .map((r) => {\r\n      const globalPath = getGlobalDir(r, explicitConfigDir);\r\n      return globalPath.replace(os.homedir(), '~');\r\n    })\r\n    .join(', ');\r\n\r\n  const localExamples = runtimes\r\n    .map((r) => `./${getDirName(r)}`)\r\n    .join(', ');\r\n\r\n  console.log(\r\n    `  ${yellow}Where would you like to install?${reset}\\n\\n  ${cyan}1${reset}) Global ${dim}(${pathExamples})${reset} - available in all projects\r\n  ${cyan}2${reset}) Local  ${dim}(${localExamples})${reset} - this project only\r\n`,\r\n  );\r\n\r\n  rl.question(`  Choice ${dim}[1]${reset}: `, (answer: string) => {\r\n    answered = true;\r\n    rl.close();\r\n    const choice = answer.trim() || '1';\r\n    const isGlobal = choice !== '2';\r\n    installAllRuntimes(runtimes, isGlobal, true);\r\n  });\r\n}\r\n\r\n/**\r\n * Install MAXSIM for all selected runtimes\r\n */\r\nfunction installAllRuntimes(\r\n  runtimes: RuntimeName[],\r\n  isGlobal: boolean,\r\n  isInteractive: boolean,\r\n): void {\r\n  const results: InstallResult[] = [];\r\n\r\n  for (const runtime of runtimes) {\r\n    const result = install(isGlobal, runtime);\r\n    results.push(result);\r\n  }\r\n\r\n  const statuslineRuntimes: RuntimeName[] = ['claude', 'gemini'];\r\n  const primaryStatuslineResult = results.find((r) =>\r\n    statuslineRuntimes.includes(r.runtime),\r\n  );\r\n\r\n  const finalize = (shouldInstallStatusline: boolean): void => {\r\n    for (const result of results) {\r\n      const useStatusline =\r\n        statuslineRuntimes.includes(result.runtime) && shouldInstallStatusline;\r\n      finishInstall(\r\n        result.settingsPath,\r\n        result.settings,\r\n        result.statuslineCommand,\r\n        useStatusline,\r\n        result.runtime,\r\n        isGlobal,\r\n      );\r\n    }\r\n  };\r\n\r\n  if (primaryStatuslineResult && primaryStatuslineResult.settings) {\r\n    handleStatusline(\r\n      primaryStatuslineResult.settings,\r\n      isInteractive,\r\n      finalize,\r\n    );\r\n  } else {\r\n    finalize(false);\r\n  }\r\n}\r\n\r\n// Main logic\r\nif (hasGlobal && hasLocal) {\r\n  console.error(\r\n    `  ${yellow}Cannot specify both --global and --local${reset}`,\r\n  );\r\n  process.exit(1);\r\n} else if (explicitConfigDir && hasLocal) {\r\n  console.error(\r\n    `  ${yellow}Cannot use --config-dir with --local${reset}`,\r\n  );\r\n  process.exit(1);\r\n} else if (hasUninstall) {\r\n  if (!hasGlobal && !hasLocal) {\r\n    console.error(\r\n      `  ${yellow}--uninstall requires --global or --local${reset}`,\r\n    );\r\n    process.exit(1);\r\n  }\r\n  const runtimes: RuntimeName[] =\r\n    selectedRuntimes.length > 0 ? selectedRuntimes : ['claude'];\r\n  for (const runtime of runtimes) {\r\n    uninstall(hasGlobal, runtime);\r\n  }\r\n} else if (selectedRuntimes.length > 0) {\r\n  if (!hasGlobal && !hasLocal) {\r\n    promptLocation(selectedRuntimes);\r\n  } else {\r\n    installAllRuntimes(selectedRuntimes, hasGlobal, false);\r\n  }\r\n} else if (hasGlobal || hasLocal) {\r\n  installAllRuntimes(['claude'], hasGlobal, false);\r\n} else {\r\n  if (!process.stdin.isTTY) {\r\n    console.log(\r\n      `  ${yellow}Non-interactive terminal detected, defaulting to Claude Code global install${reset}\\n`,\r\n    );\r\n    installAllRuntimes(['claude'], true, false);\r\n  } else {\r\n    promptRuntime((runtimes) => {\r\n      promptLocation(runtimes);\r\n    });\r\n  }\r\n}\r\n"],"mappings":"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"}