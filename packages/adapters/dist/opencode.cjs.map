{"version":3,"file":"opencode.cjs","names":["expandTilde","path","os","replacePathReferences","convertClaudeToOpencodeFrontmatter"],"sources":["../src/opencode.ts"],"sourcesContent":["/**\n * @maxsim/adapters â€” OpenCode adapter\n *\n * Ports the OpenCode-specific logic from bin/install.js:\n *   - getOpencodeGlobalDir()           (lines 79-97)\n *   - getGlobalDir('opencode', ...)    (lines 104-111)\n *   - getDirName('opencode')           (line 46)\n *   - getConfigDirFromHome('opencode', isGlobal) (lines 58-68)\n *   - convertClaudeToOpencodeFrontmatter + path replacement\n */\n\nimport * as path from 'node:path';\nimport * as os from 'node:os';\nimport type { AdapterConfig } from '@maxsim/core';\nimport { expandTilde } from './base.js';\nimport { convertClaudeToOpencodeFrontmatter } from './transforms/frontmatter.js';\nimport { replacePathReferences } from './transforms/content.js';\n\n/**\n * Get the global config directory for OpenCode.\n * OpenCode follows XDG Base Directory spec and uses ~/.config/opencode/.\n * Priority: OPENCODE_CONFIG_DIR > dirname(OPENCODE_CONFIG) > XDG_CONFIG_HOME/opencode > ~/.config/opencode\n */\nfunction getOpencodeGlobalDir(): string {\n  if (process.env.OPENCODE_CONFIG_DIR) {\n    return expandTilde(process.env.OPENCODE_CONFIG_DIR);\n  }\n  if (process.env.OPENCODE_CONFIG) {\n    return path.dirname(expandTilde(process.env.OPENCODE_CONFIG));\n  }\n  if (process.env.XDG_CONFIG_HOME) {\n    return path.join(expandTilde(process.env.XDG_CONFIG_HOME), 'opencode');\n  }\n  return path.join(os.homedir(), '.config', 'opencode');\n}\n\n/**\n * Get the global config directory for OpenCode.\n * Priority: explicitDir > env vars (via getOpencodeGlobalDir)\n */\nfunction getGlobalDir(explicitDir?: string | null): string {\n  if (explicitDir) {\n    return expandTilde(explicitDir);\n  }\n  return getOpencodeGlobalDir();\n}\n\n/**\n * Get the config directory path relative to home for hook templating.\n */\nfunction getConfigDirFromHome(isGlobal: boolean): string {\n  if (!isGlobal) {\n    return \"'.opencode'\";\n  }\n  return \"'.config', 'opencode'\";\n}\n\n/**\n * Transform markdown content for OpenCode installation.\n * Applies frontmatter conversion and path replacement.\n */\nfunction transformContent(content: string, pathPrefix: string): string {\n  let result = replacePathReferences(content, pathPrefix, '.opencode');\n  // Also replace ~/.opencode/ references\n  result = result.replace(/~\\/\\.opencode\\//g, pathPrefix);\n  result = convertClaudeToOpencodeFrontmatter(result);\n  return result;\n}\n\n/**\n * OpenCode adapter configuration.\n * OpenCode uses flat command structure (command/maxsim-*.md).\n */\nexport const opencodeAdapter: AdapterConfig = {\n  runtime: 'opencode',\n  dirName: '.opencode',\n  getGlobalDir,\n  getConfigDirFromHome,\n  transformContent,\n  commandStructure: 'flat',\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAuBA,SAAS,uBAA+B;AACtC,KAAI,QAAQ,IAAI,oBACd,QAAOA,yBAAY,QAAQ,IAAI,oBAAoB;AAErD,KAAI,QAAQ,IAAI,gBACd,QAAOC,UAAK,QAAQD,yBAAY,QAAQ,IAAI,gBAAgB,CAAC;AAE/D,KAAI,QAAQ,IAAI,gBACd,QAAOC,UAAK,KAAKD,yBAAY,QAAQ,IAAI,gBAAgB,EAAE,WAAW;AAExE,QAAOC,UAAK,KAAKC,QAAG,SAAS,EAAE,WAAW,WAAW;;;;;;AAOvD,SAAS,aAAa,aAAqC;AACzD,KAAI,YACF,QAAOF,yBAAY,YAAY;AAEjC,QAAO,sBAAsB;;;;;AAM/B,SAAS,qBAAqB,UAA2B;AACvD,KAAI,CAAC,SACH,QAAO;AAET,QAAO;;;;;;AAOT,SAAS,iBAAiB,SAAiB,YAA4B;CACrE,IAAI,SAASG,0CAAsB,SAAS,YAAY,YAAY;AAEpE,UAAS,OAAO,QAAQ,oBAAoB,WAAW;AACvD,UAASC,uDAAmC,OAAO;AACnD,QAAO;;;;;;AAOT,MAAa,kBAAiC;CAC5C,SAAS;CACT,SAAS;CACT;CACA;CACA;CACA,kBAAkB;CACnB"}